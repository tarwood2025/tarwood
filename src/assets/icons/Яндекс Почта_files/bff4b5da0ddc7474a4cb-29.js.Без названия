/*! For license information please see bff4b5da0ddc7474a4cb-29.js.LICENSE */
webpackJsonp([29],{1074:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NsReactView=void 0;var a=o(n(134)),r=o(n(138)),s=o(n(359)),l=n(333);t.NsReactView=function(e){var t=Array.isArray(e.models)?e.models.reduce(function(e,t){var n;return i(i({},e),((n={})[t]="keepValid",n))},{}):e.models||{};return{params:e.params,events:{"ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-htmlinit":"onHtmlInit"},yateModule:e.yateModule,models:t,methods:i(i({},e.methods||{}),{onShow:function(){var t,n;this.container=e.selector?this.node.querySelector(e.selector):this.node,this.container&&(r.default.render(a.default.createElement(s.default,{lang:l.getLocale()},a.default.createElement(e.component,i({params:this.params},e.props||{}))),this.container),null===(n=null===(t=e.methods)||void 0===t?void 0:t.onShow)||void 0===n||n.call(this))},onHide:function(){var t,n;this.container&&(r.default.unmountComponentAtNode(this.container),null===(n=null===(t=e.methods)||void 0===t?void 0:t.onHide)||void 0===n||n.call(this))},onHtmlInit:function(){var t,n;null===(n=null===(t=e.methods)||void 0===t?void 0:t.onHtmlInit)||void 0===n||n.call(this)}})}}},208:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4613);n.n(i);Jane.module("setup.js",function(){Daria.setup={},n(4614),n(4615),n(4624),n(4625)})},4613:function(e,t){},4614:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(86)),a=n(333),r=n(329);yr.externals["from-user-emails"]=function(){var e=Object(r.getAddressInformationModelName)();return $.map(ns.Model.get(e).getFromEmails(),function(e){return{data:e}})},yr.externals["get-send-undo-times"]=function(){return{time:[0,5,10,15,30]}},yr.externals["is-folder-disabled-in-filters"]=function(e){return i.FiltersDisabledFolders.includes(e)},yr.externals["make-email"]=function(e,t){return"".concat(e,"@").concat(t)},yr.externals["setup-urls"]=o.getSetupUrls,yr.externals["show-inbox-gpt"]=a.showInboxGPT,yr.externals["shared-mailboxes"]=r.isSharedMailboxes},4615:function(e,t,n){n(4616),n(4617),n(4618),n(4620),n(4621),n(4622),n(4623)},4616:function(e,t){Daria.actions.define("filters.edit",function(e,t){Daria.FilterSimpleCreate({form:t.$form,validate:function(e){return t.isValid||Daria.SetupFiltersCreate.validate(t.$form,e)},success:function(e){t.callback?t.callback(e):Daria.router.navigate("#setup/filters")}}).create()}),Daria.actions.define("filters.show-filter-name",function(e,t,n,i){$(i.target).closest(".b-form-layout__block").addClass("g-hidden").next(".b-form-layout__block").removeClass("g-hidden").find(".b-form-element__input-text").focus()})},4617:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(340),o=(n.n(i),n(343)),a=(n.n(o),n(340));n.n(a);Daria.actions.define("filters.lists-add-from-message",function(e,t){var n=(t=t||e.params).email;if(n){var r=t.listtype;$(document).trigger("b-mail-dropdown-closeall"),ns.forcedRequest(["filters-blacklist","filters-whitelist"],{}).then(function(){var e="black"===r?"appendEmailBlackList":"appendEmailWhiteList",t=Daria.Filter[e](n);t.then(s,l,function(e,t){var i="",o="",a="";switch(e){case"already-in-anti":i="black"===r?i18n("%Setup_Filters_blist_from_wlist",n):i18n("%Setup_Filters_wlist_from_blist",n),o=i18n("%Да"),a=i18n("%Нет");break;case"is-yandex-email":i=(t=t||{}).name&&t.unsubscribeLink?i18n("%Blacklist_warning_popup_content",t.name,t.unsubscribeLink):i18n("%Blacklist_warning_popup_content_unknown_service"),o=i18n("%Blacklist_warning_popup_button");break;default:return}var s=this;Daria.Dialog.confirm({body:i,width:350,okValue:o,cancelValue:a,okHandler:function(){s.notify("ok")},oncancel:function(){s.reject("cancel")}})}.bind(t))})}function s(){Object(i.showStatuslineComponent)({name:o.StatuslineName.EmailAddedToBlacklist,email:n})}function l(e){var t;switch(e){case"own-email":t="black"===r?{name:o.StatuslineName.FiltersBlacklistAddSelfForbidden,text:i18n("%Setup_Filters_blist_add_self_forbidden")}:{name:o.StatuslineName.FiltersWhitelistAddSelfForbidden,text:i18n("%Setup_Filters_wlist_add_self_forbidden")};break;case"already":t={name:o.StatuslineName.FiltersBlackWhiteListAlreadyExist,text:"black"===r?i18n("%Setup_Filters_blist_already_js"):i18n("%Setup_Filters_wlist_already_js")};break;case"cancel":return;default:t={name:o.StatuslineName.FiltersBlackWhiteListAddError,text:i18n("%Setup_Общая_ошибка")}}Object(a.showErrorMessage)(t.name,t.text)}})},4618:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4619),o=n(136);n.n(o);Daria.actions.define("folders.add",function(e,t,n,i){Jane.Services.run("#setup",function(){var e=Daria.FolderCreatePopup(t);$.extend(e,{success:function(e){t["only-create"]?Daria.router.navigate():t.mMessagesChecked?(t.fid=e,t.mMessagesChecked.runAction("move",t)):Daria.actions.run("move",{fid:e,toolbar:t.toolbar},null,i)}}),e.init()})}),Daria.actions.define("folder.clear",function(e,t,n,a){var r=t.fid;t.onTarget&&a.currentTarget&&(t.targetOffset=$(a.currentTarget).offset().top+$(a.currentTarget).height()/2-$(window).scrollTop()),t.symbol&&Object(i.a)(r,"Clear click"),"extended"!==t.type||ns.Model.get("folders").isFolder(r,[o.WellKnownFolderSymbol.TRASH])?t.template="<p>"+i18n("%Folders_Clear_Text")+"</p>":t.template=$(Jane.tt("setup:js-setup-folders-dialog-folder-exclear")),Jane.Services.runModules(["setup.js"],function(){var e=Daria.FolderClearPopup(t);_.extend(e,{onsuccess:function(){var e=ns.page.refresh();Daria.is3pane()&&t.fid===Daria.router.getCurrentParams().current_folder&&(e=e.then(function(){var e=0===ns.Model.get("messages",Daria.router.getCurrentParams()).getCount();ns.events.trigger("mail:splitter:toggleOnePaneMode",e)})),e.then(function(){ns.events.trigger("folder.cleared",t.fid)})}}),e.init()}),t.metrika&&ns.action.run("common.clck",t)})},4619:function(e,t,n){"use strict";function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Jane.c.apply(Jane,["Left column",Daria.is2pane()?"2pane":"3pane",ns.Model.get("settings").get(".show_folders_tabs")?"Tabs list":"Folders list"].concat(t))}t.a=function(e,t){var n=ns.Model.get("folder",{fid:e}).get(".symbol");n?i("system",n,t):i("user folder",t)}},4620:function(e,t){Daria.actions.define("folders.add.filters",function(e,t){var n=Vow.promise(),i=Daria.FolderCreatePopup(t);return $.extend(i,{success:function(e){n.fulfill({id:e,name:i.folderName})},filter:!1}),i.init(),n})},4621:function(e,t){Daria.actions.define("header.update-default-email",function(e,t){var n=t.email||ns.Model.get("settings").getSetting("default_email");n&&($(".js-header-user-name").text(n),$(".js-messages-title-dropdown-name").text(n))})},4622:function(e,t){Daria.actions.define("labels.add.filters",function(e,t){var n=Daria.LabelCreatePopup(t),i=Vow.promise();return no.extend(n,{context:$(Jane.tt("setup:js-setup-folders-dialog-label-create",{},["labels-colors"])),filter:!1,success:function(e){i.fulfill({id:e,name:n.labelName})}}),n.init(),i})},4623:function(e,t){Daria.actions.define("folders.move-in-folder",function(e,t,n){var i=$(n||t.$target);i.closest(".b-folders_dropdown").find(".b-folders__folder_current").removeClass("b-folders__folder_current"),i.closest(".b-folders__folder").addClass("b-folders__folder_current"),t.fid?$(".js-selink__folder").attr("data-fid",t.fid).text(i18n("%Put_in_Folder",t.name)):$(".js-selink__folder").removeAttr("data-fid").text(i18n("%Dont_Put_in_Folder")),Daria.actions.run("dropdown.close-current")})},4624:function(e,t){!function(){var e={"app right-box@":function(e){var t=Daria.hasFeature("web-b2b-autoreply");if(!e.tab||"index"===e.tab)return{"react-setup-index":{}};if("collectors"===e.tab||"collector"===e.tab)return{"react-setup-collectors":{}};if("autoreply"===e.tab&&t)return{"react-setup-autoreply":{}};var n={},i=e.tab||"index";return n["setup-"+i]={},"other"===i&&(n["setup-"+i]["checkbox-tree-popup-toggle"]=!0),"filters-create"===i&&(n["setup-"+i]["messages-preview-box@"]={"messages-preview":{}}),n}};ns.layout.define("setup",e,"common"),ns.layout.define("setup-collector",{"app right-box@":function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},"react-setup-collectors",{})},"setup"),ns.layout.define("setup-sender",{"app right-box@":{"setup-sender":function(){var e={"signature-promo-box@":{"signature-promo":{}}};return Daria.IS_CORP||(e["setup-avatar-setup-box@"]={"setup-avatar-setup":{}}),e}}},"setup"),ns.layout.define("checkbox-tree-popup",{"checkbox-tree-popup":{"checkbox-tree":{}}})}()},4625:function(e,t,n){n(4626),n(4627),n(4628),n(4629),n(4630),n(4631),n(4632),n(4633),n(4634),n(4635),n(4636),n(4637),n(4638),n(4639),n(4640),n(4641),n(4643),n(4663)},4626:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(329)),a=n(340).showSuccessMessage,r=n(343).StatuslineName;Daria.Folder=function(e){var t="boolean"!=typeof(e=e||{}).hotkey||e.hotkey;return{validate:function(){var t=this.folderName;if(!t)return ns.events.trigger("folder.error",i18n("%Setup_Filters_Create_Error_Empty")),!1;var n=ns.Model.get("folders"),o=this.parent_folder&&this.parent_folder.data("fid")||e.parent_id,a=n.getFidBySymbol(i.WellKnownFolderSymbol.INBOX),r=n.data.folder.find(function(n){return n.fid!==e.id&&(n.name===t&&(o?n.parent_id===String(o):!n.parent_id||n.parent_id===a))});if(r){var s=r.symbol?i18n("%Folders_System_Msg",t):i18n("%Folders_Exists_Msg");return ns.events.trigger("folder.error",s),!1}return!0},setName:function(e){this.folderName=e},bindEvents:function(){var e=this,n=this.context.find(".b-teaser"),i=this.context.find(".b-form-layout_filters-simple");this.filter&&(this.filter.form=i.find("form"));var o={cls:"b-popup__field_error",active:!1,show:function(t){this.notification=e.context.find(".b-notification__text"),this.row=this.notification.closest(".b-table"),t&&(this.notification.text(t),this.row.addClass(this.cls),this.active=!0)},hide:function(){this.row.removeClass(this.cls),this.active=!1,ns.events.trigger("folder.error.hide")}};ns.events.on("folder.error",function(t,n){o.show(n),e.input.focus()}),this.context.on("click",".js-filter-open",function(){Jane.c(["Поп-ап создания папки","клик на открыть фильтры"]),n.fadeOut(150,function(){i.fadeIn(200,function(){var e=i.find("input:visible").eq(0).focus(),t=Daria.Autocompleter.getContact();t.setOptions({multiple:!1,formatResult:Daria.formatAutocompleteResult}),t.bindField({field:e,focus:1}),ns.events.trigger("folder.filter.toggle",!0)})})}),this.context.on("click",".js-filter-close",function(){Jane.c(["Поп-ап создания папки","клик на свернуть фильтры"]),i.fadeOut(150,function(){n.fadeIn(200,function(){e.input.focus(),ns.events.trigger("folder.filter.toggle",!0)})})}),this.context.on("click",".js-filter-link",function(){return e.filter=!1,e.success=function(e){Daria.router.navigate("#setup/filters-create/folder="+e)},e.onCreate(),!1}),this.context.on("keyup",".js-input-name",function(n){var i=$.trim(this.value);i!=e.folderName&&o.active&&o.hide(),e.setName(i),13===n.which&&t&&e.onCreate()}),this.context.on("click",".js-dropdown-folder-labels",function(){var e=$(window).height()-$(this).rect().top-40;$(".js-folders-list").css("max-height",e).scrollTop(0)})},filter:Daria.FilterSimpleCreatePopup(),onCreate:function(){var e=this;if(this.setName($.trim(this.input[0].value)),this.validate()){Daria.Dialog.close();var t=null;this.parent_folder&&this.parent_folder[0]&&(t=this.parent_folder[0].getAttribute("data-fid")||null),this.create(function(t){e.filter&&(e.filter.params.move_folder=t,e.filter.create())},null,t)}},init:function(){this.input=$("input[name=folder_name]",this.context),this.parent_folder=$(".js-selink__folder",this.context),e.name&&this.input.val(e.name),this.bindEvents(),this.open()}}},Daria.Folder.REMOVABLE_SYMBOLS={archive:!0},Daria.Folder.remove=function(e){var t,n=Object(o.getMailboxUid)(),s=ns.Model.get("folders",{mailboxUid:n}),l=s.getFolderById(e),c=_.escape(l.name),d=Number(l.count);s.getSubfolders(e).length&&(t=function e(t){for(var n=s.getSubfolders(t),i=0,o=0;o<n.length;o++){var a=n[o];i+=Number(a.count),s.getSubfolders([a.fid]).length&&(i+=e(a.fid))}return i}(e));var u=ns.Model.get("filters").getForFolder(e),f=[],h=[];$.each(u,function(e,t){jpath(t,'.condition[.div == "X-yandex-rpop-id"]').length?f.push(t):h.push(t)});var p,b=h.length,m=f.length,g=Daria.router.getCurrentParams().current_folder,v=g===e||ns.Model.get("folders",{mailboxUid:n}).hasChildByFid(e,g),y=function(t){var o=[{id:"do-folder-remove",params:{fid:e,force:t?"yes":"",mailboxUid:n}},{id:"folders",params:{mailboxUid:n}}];Daria.Folder.REMOVABLE_SYMBOLS[l.symbol]&&o.unshift({id:"do-folder-set-symbol",params:{fid:e,symbol:"",mailboxUid:n}}),ns.forcedRequest(o).then(function(t){"async"===(t[0].data.taskType||"sync")&&a(r.FolderDelete,i18n("%Message_Delete_Folder_async")),ns.events.trigger("daria:folder-remove-done",e),v&&Daria.router.navigate(Daria.router.buildUrl("messages",{current_folder:s.getFidBySymbol(i.WellKnownFolderSymbol.INBOX)}))},function(){ns.events.trigger("daria:folder-remove-fail",e)})},k=function(){for(var e=[],t=0;t<b;t++){var n=h[t];e.push('— «<a href="#setup/filters-create/id='+n.filid+'">'+_.escape(n.name||i18n("%Setup_Filters_default_rule_name"))+"</a>»<br/>")}return e.join("")},w=[],S=i18n("%Folders_Remove_Button");d&&b?(w.push(i18n("%Folders_Remove_Messages_Filters_Body_1",d,b,c)),w.push(k()),w.push(i18n("%Folders_Remove_Messages_Filters_Body_2",d,b)),S=i18n("%Folders_Remove_Messages_Filters_Button",d,b)):d&&t?(w.push(i18n("%Folders_Remove_Messages_Submessages_Body",d+t,c)),p=d+t>1?2:1,S=i18n("%Folders_Remove_Messages_Button",p)):d?(w.push(i18n("%Folders_Remove_Messages_Body",d,c)),p=d>1?2:1,S=i18n("%Folders_Remove_Messages_Button",p)):t?(w.push(i18n("%Folders_Remove_SubMessages_Body",t,c)),p=t>1?2:1,S=i18n("%Folders_Remove_Messages_Button",p)):b&&(w.push(i18n("%Folders_Remove_Filters_Body_1",b)),w.push(k()),w.push(i18n("%Folders_Remove_Filters_Body_2",b)),S=i18n("%Folders_Remove_Filters_Button",b)),m&&w.push(i18n("%Folders_Remove_Collectors_Body",m,d||b)),d||b||m||t?Daria.Dialog.confirm({title:i18n("%Folders_Remove_Title"),width:450,body:w.join(""),additionalClass:"b-setup-popup",isMaxHeight:!0,okValue:S,okHandler:function(){(y(!0),b||m)&&ns.Model.get("filters").getForFolder(e).forEach(function(e){Daria.Filter.removeById(e.filid)})}}):y()},Daria.Folder.createFilter=function(e){var t=$(Jane.tt("setup:js-setup-folders-dialog-folder-filter",{fid:e,single:null}));t.on("click",".js-filter-link",function(){Jane.c(["Новый поп-ап фильтров","папка","клик на подробные условия"])});var n=Daria.FilterSimpleCreatePopupSingle({form:t.find("form")});Daria.Dialog.open({title:i18n("%Setup_Filters_Simple_title_folder"),body:t,buttons:[{name:"submit",value:i18n("%Setup_filters-create_title"),onclick:function(){return Jane.c(["Новый поп-ап фильтров","папка","клик по создать"]),n.create()}},{name:"cancel"}],oncancel:function(){Jane.c(["Новый поп-ап фильтров","папка","клик по отменить"])},width:432,onopen:function(){Jane.c(["Новый поп-ап фильтров","папка","показ поп-апа для создания фильтра на папку"]),t.find("input[name=field3]:eq(0)").focus(),n.bindAutocompleter()}})}},4627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(329));Daria.FolderEditPopup=function(e){var t=Daria.Folder(e),n=e.id,a=Object(o.getMailboxUid)(),r=ns.Model.get("folders",{mailboxUid:a}),s=r.getFolderById(n).parent_id;return r.getFolderBySymbol(i.WellKnownFolderSymbol.INBOX).fid===s&&(s=0),$.extend(t,{context:$(Jane.tt("setup:js-setup-folders-dialog-folder-edit",{fid:n,filter:null,withoutSubfolderDialog:!0},["folders"])),create:function(e){var t=this,i=Object(o.getMailboxUid)();ns.forcedRequest([{id:"do-folder-rename",params:{fname:this.folderName,fid:n,parent_id:s,mailboxUid:i}},{id:"folders",params:{mailboxUid:i}}]).then(function(){$.isFunction(e)&&e(n),$.isFunction(t.success)&&(t.success(n,t.folderName),ns.Model.get("folders",{mailboxUid:i}).trigger("daria:mFolders:rename")),ns.events.trigger("daria:folders:edit")})},open:function(){var e=this;Daria.Dialog.open({title:i18n("%Folders_Edit_Title"),body:this.context,buttons:[{name:"submit",value:i18n("%Сохранить"),onclick:this.onCreate.bind(this)},{name:"cancel"}],width:432,onopen:function(){e.input.focus(),e.input.keyup()}}),$(document).trigger("b-mail-dropdown-closeall")}}),t}},4628:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(1443)),a=n(329);Daria.FolderClearPopup=function(e){var t=Daria.Folder(e);return $.extend(t,{context:e.template,init:function(){var t=this,n=null;if(e.targetOffset){var r=$(".js-layout-left");n={x:r.offset().left+r.width(),y:e.targetOffset,side:"left",pos:"top"}}Daria.Dialog.confirm({title:i18n("%Folders_Clear_Title"),body:e.template,nbInit:!0,onTarget:n,width:455,okValue:i18n("%Setup_Folders_Очистить"),onopen:function(e){e.$body.on("click",".js-filter-open,.js-filter-close",function(e){$(e.target).closest(".js-popup").find(".js-teaser-toggle,.js-extra-toggle").toggleClass("g-hidden")})},onclose:function(e){e.$body.off("click",".js-filter-open,.js-filter-close")},okHandler:function(){var n,r,s=$(this.body),l=s.find(".nb-checkbox"),c=Object(a.getMailboxUid)();l.each(function(e){var t=nb.block(l[e]);t&&t.isChecked()&&(r=t)}),n="extended"!==e.type||ns.Model.get("folders",{mailboxUid:c}).isFolder(e.fid,[i.WellKnownFolderSymbol.TRASH])?{method:"purge",fid:e.fid,mailboxUid:c}:{method:r?r.getValue():"",fid:e.fid,old_f:nb.$block(".js-old_f",s).getState().value,from_f:nb.$block("#from_f",s).getValue(),subj_f:nb.$block("#subj_f",s).getValue(),mailboxUid:c},Object(o.a)(n).then(function(){$.isFunction(t.onsuccess)&&t.onsuccess(n.fid)},function(){$.isFunction(t.onerror)&&t.onerror(n.fid)})}})}}),t},Daria.setup.doFolderClear=o.a},4629:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(329));Daria.FolderCreatePopup=function(e){e=e||{};var t=Daria.Folder(e);return $.extend(t,{context:$(Jane.tt("setup:js-setup-folders-dialog-folder-create",{filter:null,folders:ns.Model.get("folders").getData(),isFolderPopup:!0,withoutSubfolderDialog:e.withoutSubfolderDialog})),create:function(t,n,a){var r=this,s=this.folderName,l=a;e.withoutSubfolderDialog&&e.parent_id&&(l=e.parent_id);var c=Object(o.getMailboxUid)(),d=ns.Model.get("folders",{mailboxUid:c}),u={folder_name:s,mailboxUid:c};l&&!d.isSystemFolder(l)&&(u.parent_id=l),ns.forcedRequest([{id:"do-folders-add",params:u},{id:"folders",params:{mailboxUid:c}}]).then(function(){var e,n=(e=l&&l!==d.getFidBySymbol(i.WellKnownFolderSymbol.INBOX)?d.getFolderByName(s,l):d.getFolderByName(s))&&e.fid;$.isFunction(t)&&t(n),$.isFunction(r.success)&&r.success(n),ns.events.trigger("daria:folders:create")},function(){$.isFunction(n)&&n.call(r)})},open:function(){var t=this;Daria.Dialog.open({title:i18n("%Folders_Создаём_папку"),body:this.context,buttons:[{name:"submit",value:i18n("%Folders_Add_Button"),onclick:function(){Jane.c(["Поп-ап создания папки","клик по создать"]),t.onCreate()}},{name:"cancel"}],width:432,oncancel:function(){Jane.c(["Поп-ап создания папки","клик по отменить"])},onopen:function(){if(Jane.c(["Поп-ап создания папки","показ поп-апа"]),t.input.keyup(),t.input.focus(),!e.withoutSubfolderDialog&&e.parent_id){var n=$(".js-popup:visible .js-folders-list .folder-"+e.parent_id);n.length&&Daria.actions.run("folders.move-in-folder",{$target:n,fid:e.parent_id,name:n.find(".js-folder-name").text()})}e["no-dialog"]&&(e.name&&!t.folderName&&t.setName(e.name),t.onCreate());var i=$(".js-folders-list"),o=$(".js-dropdown-folder-labels"),a=function(e){27===e.keyCode&&i.is(":visible")&&(Daria.Dropdown.closeAll(),e.preventDefault(),e.stopPropagation())};i.find("a").each(function(){var e=$(this);e.on("focus",function(){var t=e.attr("id");t&&i.attr("aria-activedescendant",t)})}),ns.events.on("daria:dropdown:open",function(){o.attr("aria-expanded","true");var e=i.find("a");e.length&&e.eq(0).focus(),window.addEventListener("keydown",a,!0)}),ns.events.on("daria:dropdown:close",function(){i.is(":visible")&&(o.attr("aria-expanded","false").focus(),i.attr("aria-activedescendant","")),window.removeEventListener("keydown",a,!0)})}}),$(document).trigger("b-mail-dropdown-closeall")}}),t}},4630:function(e,t){Daria.FolderCreateContext=function(e){var t=Daria.FolderCreatePopup(e),n=e.filter?{filter:null}:{};return n.folders=ns.Model.get("folders").getData(),n.isFolderPopup=!0,$.extend(t,{context:$(Jane.tt("setup:js-setup-folders-dialog-folder-create",n)),onCreate:function(){var e=this,t=$.Deferred(),n=function(e,n){t.reject(n)};return ns.events.on("folder.error",n),t.always(function(){ns.events.off("folder.error",n)}),this.validate()&&this.create(function(n){e.filter&&(e.filter.params.move_folder=n,e.filter.create()),t.resolve(n)},function(e){var t=1e3===Number(jpath(e,".error.code")[0])?i18n("%Folders_System_Msg",this.folderName):i18n("%Folders_Create_Error");ns.events.trigger("folder.error",t)},e.parent_folder.data("fid")),t},open:function(){e.parent.html(this.context),this.input.keyup(),this.input.focus()},success:function(){ns.page.refresh()}}),t}},4631:function(e,t){!function(){var e=function(){this.type=""};e.prototype.bindEvents=function(){var e=this,t=function(t){e.onClick(t)};this.container.click(t),this.unbindEvents=function(){this.container.unbind("click",t)}},e.prototype.unbindEvents=function(){},e.prototype.onClick=function(e){var t=this.getTarget(e);e.target.getAttribute("disabled")||t in this&&this[t](e)},e.prototype.default_tests=[["selectItem",".b-folder-list-item *, .b-folders__folder *"],["deleteItem",".nb-button[data-click-action=delete]"],["emptyItem",".nb-button[data-click-action=empty]"],["createSubfolder",".nb-button[data-click-action=subfolder]"],["editItem",".nb-button[data-click-action=edit]"],["addFilter",".nb-button[data-click-action=filter]"]],e.prototype.tests=[],e.prototype.getTarget=function(e){for(var t in this.tests)if($(e.target).is(this.tests[t][1]))return this.tests[t][0]},e.prototype.selectItem=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target).closest(".b-folder-list-item, .b-folders__folder"),n=ns.action.getParams(t[0]);this.selectedItem&&$(".item-"+this.selectedItem,this.container).removeClass("b-folders__folder_current b-folder-list-item_selected"),this.selectedItem=n.id,t.addClass("b-folders__folder_current b-folder-list-item_selected"),this.updateButtons(n)},e.prototype.deselectAll=function(){this.selectedItem&&$(".item-"+this.selectedItem,this.container).removeClass("b-folders__folder_current b-folder-list-item_selected"),delete this.selectedItem,this.updateButtons({})},e.prototype.init=function(){this.bindEvents(),this.tests=this.tests.concat(this.default_tests)},e.prototype.deleteItem=function(e){e.preventDefault(),e.stopPropagation(),Daria.actions.run(this.type+".remove",{id:this.selectedItem})},e.prototype.editItem=function(e){e.preventDefault(),e.stopPropagation(),Daria.actions.run(this.type+"s.edit",{id:this.selectedItem})},e.prototype.addFilter=function(e){e.preventDefault(),e.stopPropagation(),Daria.actions.run(this.type+".filter",{id:this.selectedItem})},e.prototype.updateButtons=function(e){var t=Number(e.editable)&&!e.shared;$("[data-click-action=edit], [data-click-action=subfolder]",this.container).each(function(){var e=nb.block(this);t?e.enable():e.disable()});var n=Number(e.editable)&&!e.shared;$("[data-click-action=delete]",this.container).each(function(){var e=nb.block(this);n?e.enable():e.disable()});var i=Number(e.count)>0&&!e.shared;$("[data-click-action=empty]",this.container).each(function(){var e=nb.block(this);i?e.enable():e.disable()});var o=Number(e.filterable)&&!e.shared;$("input[data-click-action=filter]",this.container).each(function(){var e=nb.block(this);o?e.enable():e.disable()})},Daria.ItemsListManager=e}()},4632:function(e,t){Daria.FoldersListManager=function(e){this.type="folder",this.container=e,this.init()},no.inherit(Daria.FoldersListManager,Daria.ItemsListManager),Daria.FoldersListManager.prototype.tests=[],Daria.FoldersListManager.prototype.emptyItem=function(){var e=$(".fid-"+this.selectedItem,this.container),t=Daria.parseQuery($(e[0]).data("params")),n=this.container.find(".js-clear-button"),i=Daria.parseQuery($(n[0]).data("params"));$.extend(t,i),Daria.actions.run("folder.clear",{fid:t.id,type:t.type})},Daria.FoldersListManager.prototype.createSubfolder=function(){Daria.actions.run("folders.add",{parent_id:this.selectedItem,withoutSubfolderDialog:!0})},Daria.FoldersListManager.prototype.updateButtons=function(e){var t=Number(e.editable)&&!e.shared;$.each(["setup-folders-edit","setup-folders-subfolder"],function(e,n){var i=nb.find(n);i&&(t?i.enable():i.disable())});var n=(Number(e.editable)||Number(e.removable))&&!e.shared,i=nb.find("setup-folders-delete");i&&(n?i.enable():i.disable());var o=Number(e.count)>0&&!e.shared,a=nb.find("setup-folders-empty");a&&(o?a.enable():a.disable());var r=Number(e.filterable)&&!e.shared,s=nb.find("setup-folders-filter");s&&(r?s.enable():s.disable())}},4633:function(e,t){Daria.LabelsListManager=function(e){this.type="label",this.container=e,this.init()},no.inherit(Daria.LabelsListManager,Daria.ItemsListManager),Daria.LabelsListManager.prototype.sort=function(e){ns.Model.get("settings").setSettings({label_sort:"by_"+("name"===e?"abc":"count")},function(){ns.forcedRequest(["labels"],{})});var t,n=$(".b-folder-list_labels .b-folder-list-item",this.container),i=$(".b-folder-list_labels",this.container);t="count"===e?function(e,t){return ns.action.getParams(t).count-ns.action.getParams(e).count}:function(e,t){return $(".b-label",e).text().toLowerCase()<$(".b-label",t).text().toLowerCase()?-1:1},(n=n.sort(t)).each(function(){i.append(this)})},Daria.LabelsListManager.prototype.updateButtons=function(e){var t=Number(e.editable)&&!e.shared,n=nb.find("setup-labels-edit");n&&(t?n.enable():n.disable());var i=Number(e.editable)&&!e.shared,o=nb.find("setup-labels-delete");o&&(i?o.enable():o.disable());var a=Number(e.filterable)&&!e.shared,r=nb.find("setup-labels-filter");r&&(a?r.enable():r.disable())}},4634:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(723)),a=(n.n(o),n(351)),r=n.n(a),s=n(329),l=n(340).showSuccessMessage,c=n(343).StatuslineName;Daria.Label=function(e){var t="boolean"!=typeof(e=e||{}).hotkey||e.hotkey;return{validate:function(){if(!this.labelName)return ns.events.trigger("label.error",i18n("%Setup_Filters_Create_Error_Empty")),!1;var t=ns.Model.get("labels");if((t.getLabelBySymbolicName("important_label")||{}).name===this.labelName)return ns.events.trigger("label.error",i18n("%Labels_System_Msg",this.labelName)),!1;var n=t.getUserLabelByName(this.labelName);if(n&&n.lid!==e.id){var i=n.symbol||n.social?i18n("%Labels_System_Msg",this.labelName):i18n("%Labels_Exists_Msg");return ns.events.trigger("label.error",i),!1}return!0},setName:function(e){this.labelName=e,ns.events.trigger("label.name-changed",e)},setColor:function(e){this.color=e,this.colorId=function(e){return parseInt(e,16)}(e),ns.events.trigger("label.color-changed",e)},bindEvents:function(){var e=this,n=this.context.find(".b-teaser"),i=this.context.find(".b-form-layout_filters-simple");this.colors=this.context.find(".b-label"),this.filter&&(this.filter.form=i.find("form"));var a={cls:"b-popup__field_error",active:!1,show:function(t){this.notification=e.context.find(".b-notification__text"),this.row=this.notification.closest(".b-table"),t&&(this.notification.text(t),this.row.addClass(this.cls),this.active=!0)},hide:function(){this.row.removeClass(this.cls),this.active=!1,ns.events.trigger("label.error.hide")}};function s(){Jane.c(["Промо меток","Новый поп-ап меток","клик на фильтры"]),n.fadeOut(150,function(){i.fadeIn(200,function(){var e=i.find("input:visible").eq(0).focus(),t=Daria.Autocompleter.getContact();t.setOptions({multiple:!1,formatResult:Daria.formatAutocompleteResult}),t.bindField({field:e,focus:1}),ns.events.trigger("label.filter.toggle",!0)})})}function l(){Jane.c(["Промо меток","Новый поп-ап меток",'клик по "свернуть"']),i.fadeOut(150,function(){n.fadeIn(200,function(){e.input.focus(),ns.events.trigger("label.filter.toggle",!1)})})}ns.events.on("label.error",function(t,n){a.show(n),e.input.focus()}),ns.events.on("label.name-changed",function(t,n){e.example&&e.example.toggle(Boolean(n)).html(_.escape(n))}),ns.events.on("label.color-changed",function(t,n){e.example||(e.example=$(Jane.tt("setup:label-sample")),e.context.closest(".b-popup").find(".b-popup__header").append(e.example)),e.example.css({background:Object(o.getLabelColors)(n).background})}),this.context.on("click",".js-filter-open",s),this.context.on("keyup",".js-filter-open",function(e){switch(e.which){case r.a.ENTER:s()}}),this.context.on("click",".js-filter-close",l),this.context.on("keyup",".js-filter-close",function(e){switch(e.which){case r.a.ENTER:l()}}),this.context.on("click",".js-filter-link",function(){return Jane.c(["Промо меток","Новый поп-ап меток",'клик по "сложным условиям"']),e.onCreate(function(){e.filter=!1,e.success=function(){Daria.router.navigate("#setup/filters-create/label="+e.labelName)}}),!1}),this.context.on("keyup",".js-input-name",function(n){var i=$.trim(this.value);i!==e.labelName&&a.active&&a.hide(),e.setName(i),13===n.which&&t&&e.onCreate()}),this.context.on("click",".js-label-sample",function(){var t=$(this);e._setColor(t)}),this.context.on("keyup",".js-label-sample",function(t){var n=$(this),i=Number(n.attr("data-item-row")),o=Number(n.attr("data-item-col")),a=n.closest(".js-label-samples-grid");switch(t.which){case r.a.UP:var s=i-1,l=a.find('[data-item-row="'.concat(s,'"][data-item-col="').concat(o,'"]'));l.length&&l.focus();break;case r.a.DOWN:var c=i+1,d=a.find('[data-item-row="'.concat(c,'"][data-item-col="').concat(o,'"]'));d.length&&d.focus();break;case r.a.LEFT:var u=o-1,f=a.find('[data-item-row="'.concat(i,'"][data-item-col="').concat(u,'"]'));f.length&&f.focus();break;case r.a.RIGHT:var h=o+1,p=a.find('[data-item-row="'.concat(i,'"][data-item-col="').concat(h,'"]'));p.length&&p.focus();break;case r.a.END:var b=a.find('[data-item-row="'.concat(3,'"][data-item-col="').concat(7,'"]'));b.length&&b.focus();break;case r.a.HOME:var m=a.find('[data-item-row="'.concat(0,'"][data-item-col="').concat(0,'"]'));m.length&&m.focus();break;case r.a.ENTER:e._setColor(n)}}),this.context.on("keydown",".js-label-sample",function(e){switch(e.which){case r.a.UP:case r.a.DOWN:case r.a.LEFT:case r.a.RIGHT:case r.a.END:case r.a.HOME:e.preventDefault()}})},_setColor:function(e){var t=Daria.parseQuery(e.attr("data-params"));this.colors.removeClass("b-label_current").attr("aria-selected","false"),e.addClass("b-label_current").attr("aria-selected","true"),this.setColor(t.color)},filter:Daria.FilterSimpleCreatePopup(),onCreate:function(e){var t=this;this.validate()&&(Daria.Dialog.close(),$.isFunction(e)&&e(),this.create(function(){t.filter&&(Jane.c(["Промо меток","Новый поп-ап меток","создание метки с настроенным фильтром"]),t.filter.params.move_label=ns.Model.get("labels").getLIDByName(t.labelName),t.filter.label_name=t.labelName,t.filter.create())},function(e){var t;t=1e3===Number(jpath(e,".error.code")[0])?i18n("%Labels_System_Msg",this.labelName):i18n("%Labels_Create_Error"),ns.events.trigger("label.error",t)}))},init:function(){this.input=$("input[name=label_name]",this.context),e.name&&this.input.val(e.name),this.bindEvents(),this.open()}}},Daria.Label.remove=function(e){var t=ns.Model.get("labels").getLabelById(e),n=_.escape(t.name),o=Number(t.count),a=[],r=[],d=[],u=ns.Model.get("filters").getForLabel(e);$.map(u,function(e){jpath(e,'.condition[.div == "X-yandex-rpop-id"]').length?d.push(e):r.push(e)});var f=r.length,h=d.length,p=function(t){var n=Object(s.getMailboxUid)();ns.forcedRequest([{id:"do-labels-delete",params:{lids:e,force:t?"yes":"",mailboxUid:n}},{id:"labels",params:{mailboxUid:n}}]).then(function(t){"async"===(t[0].data.taskType||"sync")&&l(c.LabelDelete,i18n("%Message_Delete_Label_async")),Daria.router.getCurrentParams().current_label===e&&Daria.router.navigate(Daria.router.buildUrl("messages",{current_folder:ns.Model.get("folders").getFidBySymbol(i.WellKnownFolderSymbol.INBOX)})),ns.events.trigger("daria:label-remove-done",e)},function(){ns.events.trigger("daria:label-remove-fail",e)})},b=function(){for(var e=[],t=0;t<f;t++){var n=r[t],i=n.filid,o=_.escape(n.name||i18n("%Setup_Filters_default_rule_name"));e.push('— «<a href="#setup/filters-create/id='+i+'">'+o+"</a>»<br/>"),a.push(i)}return e.join("")},m=[],g=i18n("%Labels_Remove_Button");o&&f?(m.push(i18n("%Labels_Remove_Messages_Filters_Body_1",o,f,n)),m.push(b()),m.push(i18n("%Labels_Remove_Messages_Filters_Body_2",f)),g=i18n("%Labels_Remove_Messages_Filters_Button",f)):o?m.push(i18n("%Labels_Remove_Messages_Body",o,n)):f&&(m.push(i18n("%Labels_Remove_Filters_Body_1",f)),m.push(b()),m.push(i18n("%Labels_Remove_Filters_Body_2",f)),g=i18n("%Labels_Remove_Filters_Button",f)),h&&m.push(i18n("%Labels_Remove_Collectors_Body",h,o||f)),o||f||h?Daria.Dialog.confirm({title:i18n("%Labels_Remove_Title"),width:400,body:m.join(""),okValue:g,okHandler:function(){if(p(!0),f||h){var t=ns.Model.get("filters").getForLabel(e);$.map(t,function(e){Daria.Filter.removeById(e.filid)})}}}):p()},Daria.Label.createFilter=function(e){var t=ns.Model.get("labels").getLabelById(e),n="important_label"===t.symbolicName?e:t.name,i=$(Jane.tt("setup:js-setup-folders-dialog-label-filter",{name:n,id:e,single:null}));i.on("click",".js-filter-link",function(){Jane.c(["Новый поп-ап фильтров","метка","клик на подробные условия"])});var o=Daria.FilterSimpleCreatePopupSingle({form:i.find("form")}),a=Vow.promise();return Daria.Dialog.open({title:i18n("%Setup_Filters_Simple_title_label"),body:i,buttons:[{name:"submit",value:i18n("%Setup_filters-create_title"),onclick:function(){Jane.c(["Новый поп-ап фильтров","метка","клик по создать"]),o.create().then(function(){a.fulfill()})}},{name:"cancel"}],oncancel:function(){Jane.c(["Новый поп-ап фильтров","метка","клик по отменить"])},width:432,onopen:function(){Jane.c(["Новый поп-ап фильтров","метка","показ поп-апа для создания фильтра на метку"]),i.find("input[name=field3]:eq(0)").focus(),o.bindAutocompleter()}}),a}},4635:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);Daria.LabelEditPopup=function(e){e=e||{};var t=Daria.Label(e),n=e.id,o=ns.Model.get("labels").getLabelById(n).color;return $.extend(t,{context:$(Jane.tt("setup:js-setup-folders-dialog-label-edit",{lid:n,filter:null},["labels-colors","labels"])),create:function(e){var t=this,o=Object(i.getMailboxUid)();ns.forcedRequest([{id:"do-label-edit",params:{lid:n,label_name:this.labelName,label_color:this.colorId,mailboxUid:o}},{id:"labels"}]).then(function(){$.isFunction(e)&&e(n),$.isFunction(t.success)&&(t.success(n),ns.Model.get("labels").trigger("daria:mLabels:rename"))})},open:function(){var e=this;Daria.Dialog.open({title:i18n("%Labels_Edit_Title")+" ",body:this.context,buttons:[{name:"submit",value:i18n("%Labels_Edit_Button"),onclick:this.onCreate.bind(this)},{name:"cancel"}],width:432,onopen:function(){e.colors.filter("[data-params*="+o+"]").click(),e.input.keyup(),e.input.focus()}}),$(document).trigger("b-mail-dropdown-closeall")}}),t}},4636:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);Daria.LabelCreatePopup=function(e){e=e||{};var t=Daria.Label(e);return no.extend(t,{context:$(Jane.tt("setup:js-setup-folders-dialog-label-create",{filter:null},["labels-colors"])),create:function(e,t){var n=this,o=this.labelName,a=Object(i.getMailboxUid)();ns.forcedRequest([{id:"do-labels-add",params:{label_name:o,label_color:this.colorId,mailboxUid:a}},{id:"labels",params:{mailboxUid:a}}]).then(function(t){var i=t[0].data.body.updated,o=ns.Model.get("labels",{mailboxUid:a}).getLabelById(i);$.isFunction(e)&&e(o.lid),$.isFunction(n.success)&&n.success(o.lid)},function(e){$.isFunction(t)&&t.call(n,e.invalid[0].getError())})},open:function(){var t=this;Daria.Dialog.open({title:i18n("%Labels_Создаём_метку")+" ",body:this.context,buttons:[{name:"submit",value:i18n("%Labels_Add_Button"),onclick:function(){Jane.c(["Промо меток","Новый поп-ап меток","клик по создать"]),t.onCreate()}},{name:"cancel"}],width:432,oncancel:function(){Jane.c(["Промо меток","Новый поп-ап меток","клик по отменить"])},onopen:function(){t.colors.eq(0).click(),t.input.keyup(),t.input.focus(),e.name&&e.color&&t.onCreate(),$.isFunction(t.onopen)&&t.onopen(),Jane.c(["Промо меток","Новый поп-ап меток","показ поп-апа"])},close:function(){$.isFunction(t.onclose)&&t.onclose()}}),$(document).trigger("b-mail-dropdown-closeall")}}),t}},4637:function(e,t){Daria.LabelCreateContext=function(e){var t=Daria.LabelCreatePopup(e),n=e.filter?{filter:null}:{};return $.extend(t,{context:$(Jane.tt("setup:js-setup-folders-dialog-label-create",n,["labels-colors"],{})),onCreate:function(){var e=this,t=$.Deferred(),n=function(e,n){t.reject(n)};return ns.events.on("label.error",n),t.always(function(){ns.events.off("label.error",n)}),this.validate()&&this.create(function(n){e.filter&&(e.filter.params.move_label=n,e.filter.create()),t.resolve(n)},function(e){var t=1e3===Number(jpath(e,".error.code")[0])?i18n("%Labels_System_Msg",this.labelName):i18n("%Labels_Create_Error");ns.events.trigger("label.error",t)}),t},open:function(){e.parent.html(this.context),this.colors.eq(0).click(),this.input.keyup(),this.input.focus(),$.isFunction(this.onopen)&&this.onopen()},success:function(){ns.page.refresh()}}),t}},4638:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);Daria.Filter={},Daria.Filter._listOfYandexEmails={"partner@market\\.(yandex|ya)\\.":{name:i18n("%ServiceTabs_market"),unsubscribeLink:Daria.Config["market-url"]+"/mail-settings.xml"},"hello@money\\.(yandex|ya)\\.":{name:i18n("%ServiceTabs_money"),unsubscribeLink:"https://sp-money.yandex.ru/tunes.xml?from=bal"},"([\\s\\S])@yandex-team\\.":{},"devnull@(yandex|ya)\\.":{},"support@(yandex|ya)\\.":{},"abo-dev@(yandex|ya)\\.":{},"hello@(yandex|ya)\\.":{},"subscriptions-no-reply@(yandex|ya)\\.":{}},Daria.Filter.checkYandexEmail=function(e){for(var t in Daria.Filter._listOfYandexEmails)if(Daria.Filter._listOfYandexEmails.hasOwnProperty(t)){var n=Daria.Filter._listOfYandexEmails[t];if(new RegExp(t+"("+Daria.Config.domainZonesForReg+")","i").test(e)){if(n.unsubscribeLink){var i=ns.Model.get("account-information").getData().login;n.unsubscribeLink=n.unsubscribeLink.replace("{LOGIN}",i)}return n}}return!1},Daria.Filter.appendEmailWhiteList=function(e){return Daria.Filter.appendEmailToList({baseHandler:"filters-whitelist",antiHandler:"filters-blacklist"},e)},Daria.Filter.appendEmailBlackList=function(e){return Daria.Filter.appendEmailToList({baseHandler:"filters-blacklist",antiHandler:"filters-whitelist",needYandexEmailsCheck:!0},e)},Daria.Filter.appendEmailToList=function(e,t){var n=$.Deferred();if(!t)return n.reject("required");if(!Jane.FormValidation.checkEmail(t))return n.reject("pattern");var i=[],o=ns.Model.get(e.baseHandler).get(".addresses"),a=ns.Model.get(e.antiHandler).get(".addresses");if(i.push({id:"do-"+e.baseHandler+"-add",params:{email:t}}),i.push({id:e.baseHandler}),ns.Model.get("account-information").isMyEmail(t))return n.reject("own-email");if(-1!==o.indexOf(t))return n.reject("already");if(-1!==a.indexOf(t))return n.progress(function(o){"ok"===o&&(i.unshift({id:"do-"+e.antiHandler+"-remove",params:{email:t}}),i.push({id:e.antiHandler}),ns.forcedRequest(i).then(n.resolve,n.reject))}),n.notify("already-in-anti");if(e.needYandexEmailsCheck){var r=Daria.Filter.checkYandexEmail(t);if(!1!==r)return n.progress(function(e){"ok"===e&&ns.forcedRequest(i).then(n.resolve,n.reject)}),n.notify("is-yandex-email",r)}return ns.forcedRequest(i).then(n.resolve,n.reject),n.promise()},Daria.Filter.removeById=function(e){var t=$.Deferred(),n=Object(i.getMailboxUid)();return ns.forcedRequest([{id:"do-filters-delete",params:{id:e,mailboxUid:n}},{id:"filters",params:{mailboxUid:n}}]).then(t.resolve,t.reject),t.promise()}},4639:function(e,t){var n={_curWindow:null,_curWindowData:null,show:function(e){var t=this,i=e.onSuccess,o=e.onCancel,a=e.onBlocked;this._curWindow&&this.closeWithCancel();var r={hooks:{onSuccess:i||_.noop,onCancel:o||_.noop,onBlocked:a||_.noop},cleanOnDestroy:[]},s="".concat(window.location.origin,"/u2709/post-response-to-opener.html"),l=Daria.Config["passport-verify-password-url"],c="".concat(l,"?retpath=").concat(encodeURIComponent(s),"&uid=").concat(Daria.uid),d=this._getWindowOptions(),u=window.open(c,"ya_verify_password_child_window",d);if(u){var f=setInterval(function(){u.closed&&t.closeWithCancel()},100);r.cleanOnDestroy.push(function(){return clearInterval(f)});var h=function(){return n.closeWithCancel()};window.addEventListener("beforeunload",h),r.cleanOnDestroy.push(function(){return window.removeEventListener("beforeunload",h)}),ns.events.on("ns-page-before-load",h),r.cleanOnDestroy.push(function(){return ns.events.off("ns-page-before-load",h)}),this._curWindow=u,this._curWindowData=r}else r.hooks.onBlocked()},close:function(e){var t=this._curWindow,n=this._curWindowData;t&&!t.closed&&t.close(),n&&n.cleanOnDestroy&&n.cleanOnDestroy.forEach(function(e){return e()}),e&&e(),this._curWindow=null,this._curWindowData=null},closeWithCancel:function(){var e=_.get(this._curWindowData,"hooks.onCancel");this.close(e)},closeWithSuccess:function(){var e=_.get(this._curWindowData,"hooks.onSuccess");this.close(e)},onResponse:function(e){this._curWindow&&e===this._curWindow&&this.closeWithSuccess()},_getWindowOptions:function(){var e=window.screenX+(document.body.clientWidth-840)/2,t=window.screenY+(document.body.clientHeight-680)/2;return["resizable=yes","location=no","toolbar=no","scrollbars=yes","chrome=yes","width=".concat(840),"height=".concat(680),"top=".concat(t),"left=".concat(e)].join(",")}};Daria.VerifyPasswordChildWindow=n,e.exports=n},4640:function(e,t){Daria.NbDependenceController=function(e,t){return this.init(e,t)},Daria.NbDependenceController.prototype={cache:null,instanceId:null,init:function(e,t){var n=this;this.cache=[],this.instanceId=t;var i=e.find(".daria-dependence-child");i.length&&(i.each(function(){var e=nb.block(this);if(e){var t=this.getAttribute("dependence-child-id");n.add(t?t.split(","):[],e)}}),e.find(".daria-dependence-parent").each(function(){var e=nb.block(this);e&&(n.add(this.getAttribute("dependence-parent-id"),e,e.getName(),"radio"===e.getType()),e.on("nb-changed",$.proxy(n.onBlockChange,n)))}),this.onDependenceChange=this.onDependenceChange.bind(this),ns.events.on("dependence.change",this.onDependenceChange))},destroy:function(){ns.events.off("dependence.change",this.onDependenceChange);var e=this;$.each($.makeArray(this.cache),function(){this.block&&this.block.off("nb-changed",$.proxy(e.onBlockChange,e))}),this.cache=[]},onDependenceChange:function(e,t){t.instance===this.instanceId&&(t.block?this.update(t.block.$node.attr("dependence-parent-id"),this._blockDisabled(t.block)):t.id&&"disable"in t&&this.update(t.id,t.disable))},onBlockChange:function(e,t){this.update(t.$node.attr("dependence-parent-id"),this._blockDisabled(t))},add:function(e,t,n,i){if(n){var o=this._blockDisabled(t),a=this._getItems(e);if(a.length)$.each(a,function(t,a){i&&(a.names[n]=e),a.ids[e]=o});else{var r={ids:{},names:{}};r.ids[e]=o,r.names[n]=e,this.cache.push(r)}}else this.cache.push({block:t,names:{},ids:function(){for(var t={},n=e.length;n--;)t[e[n]]=!0;return t}()})},_getItems:function(e){for(var t=[],n=this.cache.length;n--;)e in this.cache[n].ids&&t.push(this.cache[n]);return t},_blockDisabled:function(e){var t="invert"===e.$node.attr("dependence-parent-type");return e.isChecked()===t},_getSet:function(e){var t=this._getItems(e),n=$.map(t,function(t){for(var n in t.names)if(t.names[n]===e)return n}),i=[],o=[];function a(e){return function(t,n){n in e.names&&(o.push(e),i.push(n))}}for(var r=this.cache.length;r--;){var s=this.cache[r];e in s.ids||$.each(n,a(s))}return{items:t,hewings:o,names:i}},update:function(e,t){var n=this._getSet(e);$.each(n.items,function(i,o){this._update(e,o,t,n.names)}.bind(this)),$.each(n.hewings,function(i,o){this._update(e,o,!t,n.names)}.bind(this))},_update:function(e,t,n,i){var o=t.ids,a=!1;for(var r in $.each(i,function(e,i){i in t.names&&(o[t.names[i]]=n)}),e in o&&(o[e]=n),o)if(o[r]){a=!0;break}t.block&&this._updateBlock(t.block,a)},_updateBlock:function(e,t){e.$node.closest(".b-form-element").toggleClass("b-form-element_disabled",t),e.isChecked&&e.isChecked()&&e.$node.hasClass("daria-dependence-parent")&&t&&(e.uncheck(),ns.events.trigger("dependence.change",{block:e,instance:this.instanceId})),t?e.disable():e.enable()}}},4641:function(e,t,n){Daria.Mixins={},Daria.Mixins.Abook=Daria.Mixins.Abook||{},n(4642),Daria.Mixins.SetupTab={onBeforePageLeave:function(e,t){var n=this,i=this.super_.onBeforePageLeave;if(i&&!1===i.call(this,e,t))return!1;var o=t.get("muid")||void 0,a=Daria.router.getCurrentParams().mailboxUid;return Daria.router.getCurrentUrl()!==e||o===a||(setTimeout(function(){ns.page.updateMailboxUid(o),Daria.router.navigate("#setup"),ns.page.block.remove(n._pageBlockCallback)},0),!1)}}},4642:function(e,t){Daria.Mixins.Abook._editGroupDialogInstance=null,Daria.Mixins.Abook._editGroupDialogSubmit=function(e){var t=this._editGroupDialogInstance.$groupName.val().trim();if(!t)return this._editGroupDialogInstance.$groupName.focus(),!1;if(ns.Model.get("abook-groups").getGroupByTitle(t))return this._editGroupDialogInstance.$body.addClass("b-popup__field_error"),this._editGroupDialogInstance.errorName=t,this._editGroupDialogInstance.$groupName.focus(),!1;var n={title:t};e.tid>0&&(n.tid=e.tid),ns.forcedRequest([{id:e.handlerName,params:n},{id:"abook-groups"}]).then(function(){Daria.Dialog.close()})},Daria.Mixins.Abook.openEditGroupDialog=function(e){var t=this,n=$.Deferred();return Daria.Dialog.open({title:e.title,body:Jane.tt("setup:js-setup-abook-popup-group",{tid:e.tid},["abook-groups"]),width:340,buttons:[{name:"submit",value:e.buttonText,onclick:this._editGroupDialogSubmit.bind(this,e)},{name:"cancel"}],onopen:function(){t._editGroupDialogInstance=this,this.$body=$(this.body),this.$groupName=this.$body.find(".js-setup-abook-popup-group-name"),this.$body.on("keyup",".js-setup-abook-popup-group-name",function(n){var i=t._editGroupDialogInstance.errorName;if(i){var o=i===t._editGroupDialogInstance.$groupName.val().trim();t._editGroupDialogInstance.$body.toggleClass("b-popup__field_error",o)}13===n.keyCode&&t._editGroupDialogSubmit(e)}),this.$groupName.focus()},onclose:function(){n.resolve()}}),n.promise()}},4643:function(e,t,n){n(4644),n(4645),n(4646),n(4647),n(4648),n(4649),n(4650),n(4651),n(4652),n(4653),n(4654),n(4655),n(4656),n(4657),n(4658),n(4659),n(4660),n(4661),n(4662)},4644:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-blacklist-add",{params:{email:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4645:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-blacklist-remove",{params:{email:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4646:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-off",{params:{id:null,enabled:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4647:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-on",{params:{id:null,enabled:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4648:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-sort",{params:{list:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4649:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-whitelist-add",{params:{email:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4650:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-filters-whitelist-remove",{params:{email:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4651:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("filters-blacklist",{params:{mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite,methods:{hasEmail:function(e){return this.select('.[.addresses =="'+e+'"]')[0]}}})},4652:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("filters-preview-message",{params:{ids:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite,methods:{preprocessData:function(e){return e.date.view=Daria.MessageTime.getFormattedTime(e.date.timestamp),e}}})},4653:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("filters-preview",{events:{},params:{id:null,field1:null,field2:null,field3:null,logic:null,offset:0,count:8,mailboxUid:null,attachment:null,letter:null},paramsRewrite:function(e){return(e=Object(i.addMailboxUidParamsRewrite)(e)).count++,Object(i.addMailboxUidParamsRewrite)(e)},split:{items:".list.message",model_id:"filters-preview-message",params:{ids:".mid"}},methods:{extractData:function(e){if(e&&e.data){var t=e.data.list&&e.data.list.message;if(t&&Array.isArray(t)){var n=t.length>=this.params.count;return n&&t.pop(),{hasMore:n,list:{message:t}}}}}}})},4654:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("filters-whitelist",{params:{mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite,methods:{hasEmail:function(e){return this.select('.[.addresses =="'+e+'"]')[0]}}})},4655:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(329);ns.Model.define("do-folder-update",{params:{fid:null,mailboxUid:null},paramsRewrite:i.addMailboxUidParamsRewrite})},4656:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136);n.n(i);ns.Model.define("journal",{methods:{preprocessData:function(e){for(var t=e,n=t.journal.day,o=0;o<n.length;o++){for(var a=n[o].entry,r=0;r<a.length;r++){var s=a[r];switch(s.operation){case"abuse":var l=s.abuseType;if(-1===["spam","nonspam"].indexOf(l)){r=this.deleteEntry(a,r);break}s.spam_type=l;break;case"mark":s.condition=s.msgStatus;break;case"receive":var c=s.ftype;if(-1===["0","1","5"].indexOf(c)){r=this.deleteEntry(a,r);break}"5"===c&&s.emailFrom&&(s.emailFrom="");break;case"move":var d=s.destFid;if(d){var u=ns.Model.get("folders").getFolderById(d);u&&!u.user&&u.symbol===i.WellKnownFolderSymbol.TRASH&&(s.folder_symbol=i.WellKnownFolderSymbol.TRASH)}break;case"label":case"unlabel":var f=ns.Model.get("labels"),h=s.lids,p=f.getLabelById(h);if(!p||!p.user&&-1===["pinned_label","mute_label","important_label"].indexOf(p.symbolicName)){r=this.deleteEntry(a,r);break}s.lidText=this.lidToText(p)}}this.groupDraftOperations(a),this.removeFrequentResetFreshOperations(a)}return t},groupDraftOperations:function(e){for(var t="",n=0,i=0;i<e.length;i++){var o=e[i];"receive"===o.operation&&"5"===o.ftype?(n++,o.mid===t?(e[i-1].count=n,i=this.deleteEntry(e,i)):t=o.mid):(t="",n=0)}},removeFrequentResetFreshOperations:function(e){for(var t,n="",i=0;i<e.length;i++){var o=e[i];"reset_fresh"===o.operation&&(t||(t=o),o.country===n?Math.abs(o.date-t.date)<6e5&&(i=this.deleteEntry(e,i)):n=o.country,t=o)}},deleteEntry:function(e,t){return e.splice(t,1),t-1},lidToText:function(e){return e.user?e.name:{mute_label:i18n("%Label_mute"),pinned_label:i18n("%Label_pin")}[e.symbolicName]||e.name||""}}})},4657:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(378);n.n(i);!function(){ns.Model.define("setup-menu",{events:{"ns-model-init":function(){var e=function(e){var t=[{id:"sender",type:"menu","menu-name":i18n("%Setup_sender_name")}];Daria.Config.allowThemes&&t.unshift({id:"interface",type:"menu","menu-name":i18n("%Setup_interface_name"),title:i18n("%Setup_interface_title")});e||(Object(i.isAvailable)()&&t.push({id:"beautiful-email",type:"menu","menu-name":i18n("%Setup_beautiful-email_name"),title:i18n("%Setup_beautiful-email_name")}),t.push({id:"collectors",type:"menu","menu-name":i18n("%Setup_collectors_name"),title:i18n("%Setup_collectors_title"),item:[{id:"collector",title:i18n("%Setup_collector_title")}]}));t.push({id:"folders",type:"menu","menu-name":i18n("%Setup_folders_name")},{id:"filters",type:"menu","menu-name":i18n("%Setup_filters_name"),title:i18n("%Setup_filters_title"),item:[{id:"filters-create",title:i18n("%Setup_filters-create_title")},{id:"filters-create-simple",title:i18n("%Setup_filters-create-simple_title")},{id:"filters-edit",title:i18n("%Setup_filters-edit_title")}]},{id:"security",type:"menu","menu-name":i18n("%Setup_security_name")}),e||t.push({id:"unsubscribe-filters",type:"menu","menu-name":i18n("%Setup_subscribes_manage")});return t.push({type:"separator"},{id:"abook",type:"menu","menu-name":i18n("%Setup_abook_name")}),t.push({type:"separator"},{id:"client",type:"menu","menu-name":i18n("%Setup_client_name")},{id:"other",type:"menu","menu-name":i18n("%Setup_other_name"),title:i18n("%Setup_other_title")},{type:"separator"}),t}(Daria.IS_CORP);this.setData({"setup-menu":{item:{title:i18n("%Setup_home"),item:e}}})}}},ns.ModelStatic)}()},4658:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(378);n.n(i);!function(){var e={interface:{id:"interface",description:Daria.IS_CORP||Daria.hasSid("668")||Daria.hasSid("669")?i18n("%Setup_interface_description_3pane"):i18n("%Setup_interface_description")},sender:{id:"sender",description:i18n("%Setup_sender_description")},collectors:{id:"collectors",description:i18n("%Setup_collectors_description")},folders:{id:"folders",description:i18n("%Setup_folders_description")},filters:{id:"filters",description:i18n("%Setup_filters_description")},security:{id:"security",description:i18n("%Setup_security_description")},abook:{id:"abook",description:i18n("%Setup_abook_description")},"other-items":{items:function(){var e=["other"];(!Daria.Config["pdd-domain"]||Daria.Config["pdd-imap-enabled"]||Daria.Config["pdd-pop-enabled"])&&e.unshift("client");return e},type:"other-items"},other:{id:"other",description:""},client:{id:"client",description:i18n("%Setup_client_description")},separator:{type:"separator"},"unsubscribe-filters":{id:"unsubscribe-filters"},"beautiful-email":{id:"beautiful-email",description:i18n("%Setup_beautiful-email_description")}};ns.Model.define("setup-index-menu",{events:{"ns-model-init":function(){this.setData({"setup-index-items":function(){var t=[];Daria.Config.allowThemes&&t.push("interface");t.push("sender"),Daria.IS_CORP||(Object(i.isAvailable)()&&t.push("beautiful-email"),t.push("collectors"));t=t.concat(["folders","filters","security"]),Daria.IS_CORP||t.push("unsubscribe-filters");return function t(n){return n.reduce(function(n,i){var o,a=e[i];return a&&(o=_.extend({},a),a.items&&"function"==typeof a.items&&(o.items=t(a.items())),n.push(o)),n},[])}(t=t.concat(["separator","abook","other-items"]))}()})}}},ns.ModelStatic)}()},4659:function(e,t){ns.Model.define("signature-langs",{events:{"ns-model-init":function(){this.setData({langs:[{abbr:"ru",short:"Ru",name:"Русский"},{abbr:"en",short:"En",name:"English"},{abbr:"uk",short:"Ua",name:"Українська"},{abbr:"be",short:"By",name:"Беларуская"},{abbr:"tr",short:"Tr",name:"Türkçe"},{abbr:"kk",short:"Kz",name:"Қазақша"}]})}}})},4660:function(e,t){ns.Model.define("do-abook-group-edit",{params:{tid:null,title:null}})},4661:function(e,t){ns.Model.define("do-abook-group-remove",{params:{tid:null}})},4662:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(723);n.n(i);ns.Model.define("labels-colors",{events:{"ns-model-init":function(){this.setData({row:i.OldLabelBackgroundColors.rows.map(function(e){return{color:e}})})}}},ns.ModelStatic)},4663:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1074),o=(n.n(i),n(4664)),a=n(4666);n(4668),n(4669),n(4670),n(4671),n(4674),n(4677),n(4678),n(4679),n(4680),n(4681),n(4682),n(4683),n(4684),n(4685),n(4686),n(4687),n(4688),n(4689),n(4690),n(4691),n(4700),n(4701),n(4713),ns.View.define("react-setup-left",Object(i.NsReactView)({component:o.a,yateModule:"setup",methods:{getFocusableChildren:function(){return[this]},onFocusEvent:function(){}}})),ns.View.define("react-setup-index",Object(i.NsReactView)({component:a.a,yateModule:"setup",methods:{getFocusableChildren:function(){return[this]},onFocusEvent:function(){}}}))},4664:function(e,t,n){"use strict";var i=n(4665);n.d(t,"a",function(){return i.a})},4665:function(e,t,n){"use strict";n.d(t,"a",function(){return g});var i,o=n(134),a=n.n(o),r=n(327),s=n(691),l=(n.n(s),n(86)),c=n(692);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t,n,o){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),l=0;l<r;l++)s[l]=arguments[l+3];t.children=s}if(t&&a)for(var c in a)void 0===t[c]&&(t[c]=a[c]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var m=Object(r.observer)(function(e){var t=e.Component,n=e.themesStore,i=e.themeMaster;return b(t,{isDark:i.isActive?i.isPageDark:n.isPageDark,asideContainer:document.querySelector(".js-scroller-left")})}),g=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,a.a.PureComponent),function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(t,[{key:"render",value:function(){var e=Object(l.getSetupLeft)();return e?b(m,{Component:e,themesStore:c.ThemesStore.instance(),themeMaster:s.ThemeMaster.instance()}):null}}]),t}()},4666:function(e,t,n){"use strict";var i=n(4667);n.d(t,"a",function(){return i.a})},4667:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i,o=n(134),a=n.n(o),r=n(86);function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,d(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,a.a.PureComponent),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"render",value:function(){var e=Object(r.getSetupIndex)();return e?function(e,t,n,o){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),l=0;l<r;l++)s[l]=arguments[l+3];t.children=s}if(t&&a)for(var c in a)void 0===t[c]&&(t[c]=a[c]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(e,{}):null}}]),t}()},4668:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(343),o=(n.n(i),n(340)),a=(n.n(o),n(749)),r=n.n(a),s=n(329),l=n(768);n.n(l);function c(e,t,n,i,o,a,r){try{var s=e[a](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}var d=["undo_send_time"];ns.View.define("setup-form",{methods:{addFormCacher:function(e){this._formCachers||(this._formCachers=[]);var t=$(e).data("id")||this.id,n=_.uniqueId(t+"-"),i=new Daria.nbFormCacher($(e),n);return this._formCachers.push(i),i},getDirtyFormCacher:function(){var e,t=[];if(this._formCachers)for(e=0;e<this._formCachers.length;e++)this._formCachers[e].isFormDirty()&&t.push(this._formCachers[e]);return t.length>0?t:null},onBeforeUnloadPage:function(){this.getDirtyFormCacher()&&Daria.addUnloadText(i18n("%Setup_beforeunload"))},onPageLeave:function(){this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},offPageLeave:function(){ns.page.block.remove(this._pageBlockCallback)},onBeforePageLeave:function(e,t){var n=t.get("muid")||void 0,i=Daria.router.getCurrentParams().mailboxUid,o=n!==i;if(Daria.router.getCurrentUrl()===e&&n===i)return!0;var a=this,r=this.getDirtyFormCacher();return r?(Jane.c({"Диалог о сохранении настроек":"Показ"}),Daria.Dialog.open({width:480,body:"<p>"+i18n("%Sure_to_leave")+"</p>",additionalClass:"b-setup-popup",buttons:[{name:"save",value:i18n("%Save_and_go"),focus:!0,onclick:function(){var t=function(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var a=e.apply(t,n);function r(e){c(a,i,o,r,s,"next",e)}function s(e){c(a,i,o,r,s,"throw",e)}r(void 0)})}}(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a.isClosing=!0,Jane.c({"Диалог о сохранении настроек":"Клик по сохранить и перейти"}),_.each(r,function(e){e.getForm().submit()}),Daria.Dialog.close(),!o){t.next=7;break}return t.next=7,Object(l.delay)(300);case 7:a.offPageLeave(),ns.page.updateMailboxUid(n),Daria.router.navigate(e),a.isClosing=!1;case 11:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()},{name:"dont_save",value:i18n("%Не_сохранять"),onclick:function(){Jane.c({"Диалог о сохранении настроек":"Клик по не сохранять"}),_.each(r,function(e){e.cancelChanges()}),Daria.Dialog.close(),a.offPageLeave(),ns.page.updateMailboxUid(n),Daria.router.navigate(e)}},{link:!0,name:"cancel",value:i18n("%Отмена")}]}),!1):void 0},_getFormChangedData:function(e){var t=e.serializeObject();return _.transform(t,this._formDataTransformIterator,{})},_formDataTransformIterator:function(e,t,n){var i=Object(s.getMailboxSettingsModelName)(n),o=ns.Model.get(i),a=o.getSign(n);switch($.type(a)){case"boolean":t=Boolean(t);break;case"number":t=Number(t||0);break;default:t=String(t||"")}a!==t&&(e[n]=o.signToSetting(n,t))},_saveSettings:function(e){var t={};return Object.keys(e).forEach(function(n){var i=Object(s.getMailboxSettingsModelName)(n);t[i]=t[i]||{},t[i][n]=e[n]}),Promise.all(Object.keys(t).map(function(e){return r()(t[e])?Promise.resolve():ns.Model.get(e).setSettings(t[e])})).then(function(){return e})},onSubmitSetupForm:function(e){e.preventDefault();var t=$(e.currentTarget),n=this._getFormChangedData(t);this.filterDataIfSubscribedSettingNotChanged(n),n=this.preparationFormData(n),this._logChangedSettings(n),this.resubscribeOnFoldersTabsNotifications(n),vow.resolve(n).then(this._saveSettings,this).then(this.onSaveSettingsSuccess,this).then(function(){Object(o.showStatuslineComponent)({name:i.StatuslineName.SettingsSaved}),t.trigger("onSave",n),Object.keys(n).forEach(function(e){d.includes(e)&&Jane.c("Settings","Interface",e,n[e])})})},filterDataIfSubscribedSettingNotChanged:function(e){var t=ns.Model.get("settings");["subscribed_folders","subscribed_tabs"].forEach(function(n){e[n]&&e[n]===JSON.stringify(t.getSign(n))&&delete e[n]})},preparationFormData:function(e){return e},onSaveSettingsSuccess:function(e){},LOG_ON_CHANGE_SETTINGS:["show_folders_tabs","show_priority_stuff"],LOG_METRIC_ON_CHANGE_SETTINGS:["show_folders_tabs","show_sidebar_with_widgets"],_logChangedSettings:function(e){var t=!0,n=!1,i=void 0;try{for(var o,a=this.LOG_ON_CHANGE_SETTINGS[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;r in e&&Daria.monitoring.stat.settings({type:"change",name:r,value:e[r]})}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}var s=!0,l=!1,c=void 0;try{for(var d,u=this.LOG_METRIC_ON_CHANGE_SETTINGS[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var f=d.value;void 0!==e[f]&&Jane.c("Settings page","change setting",f,e[f]?e[f]:"off")}}catch(e){l=!0,c=e}finally{try{s||null==u.return||u.return()}finally{if(l)throw c}}},resubscribeOnFoldersTabsNotifications:function(e){if("show_folders_tabs"in e){var t=ns.Model.get("checkbox-tree-state"),n=t.syncronizeInboxBetween(e.show_folders_tabs);t.shouldSyncronizeInbox(n)&&t.resubscribeOnFoldersTabsNotifications(n)}}}})},4669:function(e,t){ns.View.define("setup-abook",{models:{"abook-groups":!0,"setup-menu":!1,settings:"onSettingsChange"},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onPageLeave","ns-view-hide":"offPageLeave","click@show .js-setup-abook-group":"_onClickSelectGroup","click@show .js-setup-abook-create-group":"_onClickCreateGroup","click@show .js-setup-abook-rename-group":"_onClickRenameGroup","click@show .js-setup-abook-remove-group":"_onClickRemoveGroup","click@show .js-abook-import":"_onClickAbookImport","click@show .js-abook-export":"_onClickAbookExport","submit@show .js-form-submit":"onSubmitSetupForm","form-cacher.unchanged@show":"onFormCacherUnchanged"},yateModule:"setup",ctor:function(){this._afterUpdateGroup=this._afterUpdateGroup.bind(this),this._pageReload=this._pageReload.bind(this),this._pageReloadOnce=_.noop},methods:_.extend({onHtmlInit:function(){this.selectedTid="",this.addFormCacher(this.$node.find(".js-setup-form-container")),this.buttons={rename:nb.$block(".js-setup-abook-rename-group",this.$node),remove:nb.$block(".js-setup-abook-remove-group",this.$node)}},_onClickAbookImport:function(e){e.preventDefault(),e.stopPropagation(),Daria.abook.openImportDialog()},_onClickAbookExport:function(e){e.preventDefault(),e.stopPropagation(),Daria.abook.openExportDialog()},_onClickCreateGroup:function(){this.openEditGroupDialog({title:i18n("%Setup_Abook_Groups_Add_Title"),handlerName:"do-abook-group-add",tid:null,buttonText:i18n("%Setup_Abook_Groups_Add_Button")}).then(this._afterUpdateGroup)},_onClickRemoveGroup:function(){ns.forcedRequest([{id:"do-abook-group-remove",params:{tid:this.selectedTid}},{id:"abook-groups"}]).then(this._afterUpdateGroup)},_onClickRenameGroup:function(){this.openEditGroupDialog({title:i18n("%Setup_Abook_Groups_Edit_Title"),handlerName:"do-abook-group-edit",tid:this.selectedTid,buttonText:i18n("%Setup_Abook_Groups_Edit_Button")}).then(this._afterUpdateGroup)},_afterUpdateGroup:function(){Daria.Autocompleter.getContact().flushCache(),Daria.router.navigate()},_onClickSelectGroup:function(e){var t=$(e.currentTarget);t.siblings().removeClass("setup-abook-group_selected"),t.addClass("setup-abook-group_selected"),this.selectedTid=t.data("tid"),this.buttons.rename.enable(),this.buttons.remove.enable()},onSettingsChange:function(){this.isVisible()?this._pageReloadOnce=_.once(this._pageReload):this.invalidate()},onFormCacherUnchanged:function(){this._pageReloadOnce()},_pageReload:function(){Daria.router.reloadPage(document.location.href)}},Daria.Mixins.Abook)},"setup-form")},4670:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(329));ns.View.define("setup-client",{models:Object.assign({folders:!0,"setup-menu":!1},Object(o.isSharedMailboxes)()?{"address-information":!0,"mailbox-settings":!0}:{"account-information":!0,settings:!0}),events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","click@show .js-enable-all-checkboxes":"onClickEnableAllCheckboxes","click@show .js-enable-imap-btn":"enableImap","click@show .js-imap-show-advantages":"onClickImapShowAdvantages","submit@show .js-form-submit":"onSubmitSetupForm"},yateModule:"setup",ctor:function(){this._foldersCheckboxes=[]},methods:{onHtmlInit:function(){this.addFormCacher(this.$node.find(".js-setup-form-container"))},onShow:function(){nb.init(this.node),this.dependence=new Daria.NbDependenceController(this.$node.find(".b-setup__inner"),"setup-client"),this.onChangeEnableImap=nb.$block(".js-enable-imap",this.$node),this.onChangeEnableImap&&this.onChangeEnableImap.on("change",this.enableImap.bind(this)),this.onChangeEnableImapPlainAuth=nb.$block(".js-enable-imap-auth-plain",this.$node),this.onChangeEnableImapPlainAuth&&this.onChangeEnableImapPlainAuth.on("change",this.enableImapPlainAuth.bind(this)),this.onChangeEnablePop=nb.$block(".js-enable-pop",this.$node),this.onChangeEnablePop&&this.onChangeEnablePop.on("change",this.enablePop.bind(this)),this.onPageLeave()},onHide:function(){this.$node.find(".js-enable-all-checkboxes").off(),this._foldersCheckboxes=[];var e=this.dependence;e&&(e.destroy(),this.dependence=void 0),nb.destroy(this.node),this.offPageLeave(),this.invalidate()},_getCheckboxByFid:function(e){return this._getFoldersCheckboxes().find(function(t){return t.$node.find("input[value="+e+"]").length})},_getFoldersCheckboxes:function(){return this._foldersCheckboxes.length?this._foldersCheckboxes:(this._foldersCheckboxes=this.$node.find(".js-settings-pop3").find(".nb-checkbox:not(.js-enable-pop):not(.js-pop-spam-subject-enable)").map(function(){return nb.block(this)}).get(),this._foldersCheckboxes)},enableImap:function(e){if(!Daria.IS_CORP){var t,n=$(e.target),i=n.closest(".b-form-layout__block");n.is("input")||(t=!0,ns.events.trigger("cachedvalue.change",{control:nb.$block(".js-enable-imap",i).check(),instance:"setup-client"})),i.find(".b-box_imap").toggleClass("is-hidden",t||n.prop("checked")),i.find(".b-box_imap_auth").toggleClass("is-hidden",!t&&!n.prop("checked"))}},enableImapPlainAuth:function(e){if(!Daria.IS_CORP){var t=$(e.target);this.$node.find(".js-enable-imap-auth-plain-related").toggleClass("is-hidden",!t.prop("checked"))}},enablePop:function(e){var t=$(e.target).closest(".b-form-layout");if(t.hasClass("b-form-layout_pop-disabled")){var n=ns.Model.get("folders").getFidBySymbol(i.WellKnownFolderSymbol.INBOX),o=this._getCheckboxByFid(n);o&&o.check(),t.removeClass("b-form-layout_pop-disabled")}else t.addClass("b-form-layout_pop-disabled")},onClickEnableAllCheckboxes:function(){for(var e=this._getFoldersCheckboxes(),t=$.grep(e,function(e){return e.isChecked()}).length!==e.length,n=e.length;n--;){var i=e[n];i.isChecked()!==t&&(t?i.check():i.uncheck(),i.$node.hasClass("daria-dependence-parent")&&ns.events.trigger("dependence.change",{block:i,instance:"setup-client"}),ns.events.trigger("cachedvalue.change",{control:i,instance:"setup-client"}))}},onClickImapShowAdvantages:function(e){$(e.target).closest(".b-box").toggleClass("b-box_imap-show-advantages")},preparationFormData:function(e){var t=_(String(e.fid||"")).chain().split(",").compact().sortBy().value();return _.assign({},e,{fid:t})},onSaveSettingsSuccess:function(e){var t=[];return e.fid&&t.push({id:"do-folder-update",params:{fid:e.fid}}),t.push({id:"folders"}),ns.forcedRequest(t)}}},"setup-form")},4671:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1074),o=(n.n(i),n(4672));n.n(o);ns.View.define("react-setup-collectors",Object(i.NsReactView)({component:o.ReactSetupCollectors,yateModule:"setup",methods:_.extend({onShow:function(){this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},onHide:function(){ns.page.block.remove(this._pageBlockCallback)}},Daria.Mixins.SetupTab)}))},4672:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactSetupCollectors=void 0;var s=a(n(134)),l=n(86),c=n(542),d=n(143),u=r(n(4673)),f=function(){return s.default.createElement("div",{className:u.default.placeholder,"data-testid":"setup-collectors-placeholder"},s.default.createElement(d.Spin,{view:"default",size:"m",progress:!0}))};t.ReactSetupCollectors=function(){var e=l.getSetupCollectorsLoader(),t=s.useCallback(function(){return e().then(function(e){var t=e.SetupCollectors;return s.default.createElement(t,null)})},[e]);return e?s.default.createElement(c.ModuleLoader,{component:t,placeholder:f}):null}},4673:function(e,t){e.exports={placeholder:"react-setup-collectors__placeholder--2RHg7"}},4674:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1074),o=(n.n(i),n(4675));n.n(o);ns.View.define("react-setup-autoreply",Object(i.NsReactView)({component:o.ReactSetupAutoreply,yateModule:"setup",methods:_.extend({onShow:function(){this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},onHide:function(){ns.page.block.remove(this._pageBlockCallback)}},Daria.Mixins.SetupTab)}))},4675:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactSetupAutoreply=void 0;var s=a(n(134)),l=n(86),c=n(542),d=n(143),u=r(n(4676)),f=function(){return s.default.createElement("div",{className:u.default.placeholder,"data-testid":"setup-autoreply-placeholder"},s.default.createElement(d.Spin,{view:"default",size:"m",progress:!0}))};t.ReactSetupAutoreply=function(){var e=l.getSetupAutoreplyLoader(),t=s.useCallback(function(){return e().then(function(e){var t=e.SetupAutoreply;return s.default.createElement(t,null)})},[e]);return e?s.default.createElement(c.ModuleLoader,{component:t,placeholder:f}):null}},4676:function(e,t){e.exports={placeholder:"react-setup-autoreply__placeholder--16R9s"}},4677:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1428),o=n(340),a=(n.n(o),n(343)),r=(n.n(a),n(329));ns.View.define("setup-filters",{models:["folders","filters","filters-blacklist","filters-whitelist","labels","setup-menu",Object(r.isSharedMailboxes)()?"address-information":"account-information"],events:{"ns-view-htmlinit":"initializeNanoislands","ns-view-htmldestroy":"destroyCache","ns-view-show":"onShow","ns-view-hide":"destroySort","change@show .js-filters-list__added":function(e){var t=$(e.currentTarget),n=this.getAllEmailsNode(t).filter(":checked"),i=nb.$block(".js-delete-button",t);i&&(n.length?i.enable():i.disable())},"submit@show .js-form-filters-lists-add":"_onSubmitFiltersListsAdd","submit@show .js-form-filters-lists-remove":"_onSubmitFiltersListsRemove","click@show .js-filters-list":"_onClickSortElement","click@show .js-filters-off":"_onClickFiltersOff","click@show .js-filters-on":"_onClickFiltersOn","click@show .js-filters-delete":"_onClickFiltersDelete","click@show .js-filters-create":"onClickFiltersCreate"},yateModule:"setup",methods:{initializeNanoislands:function(){nb.init(this.node)},getAllEmailsNode:function(e){return $(e||this.node).find(".js-email-from-list input")},_getListNode:function(){return this._$listNode?this._$listNode:(this._$listNode=$(".js-filters-list"),this._$listNode)},destroyCache:function(){delete this._$listNode},onShow:function(){this.initSort()},initSort:function(){var e=this,t=Object(r.getMailboxUid)();this._getListNode().sortable({axis:"y",cancel:"a,img",containment:"parent",tolerance:"pointer"}).on("sortstart",function(e,t){t.item.find(".js-filters-list-item").addClass("b-grab_grabbing")}).on("sortstop",function(e,t){t.item.find(".js-filters-list-item").removeClass("b-grab_grabbing")}).on("sortupdate",function(){var n=e._getListNode().sortable("toArray",{attribute:"data-params"});n=_(n).map(ns.parseQuery.bind(ns)).pluck("id").join(","),ns.forcedRequest("do-filters-sort",{list:n,mailboxUid:t})}).find(".js-filters-list-item").attr("unselectable","on")},destroySort:function(){var e=this._getListNode();try{e.sortable("destroy")}catch(e){}e.off().find(".js-filters-list-item").removeAttr("unselectable")},_onClickSortElement:function(e){e.stopPropagation();var t=$(e.target).closest("[data-params]").data("params"),n=ns.parseQuery(t).id;Daria.router.navigate(Daria.router.buildUrl("setup",{tab:"filters-create",id:n}))},_onSubmitFiltersListsRemove:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n=Daria.parseQuery(t.data("params")),i=t.serializeObject();t.find(".js-delete-button").prop("disabled",!0),i.email=$.grep($.makeArray(i.email),function(e){return e}),i.email&&i.email.length&&ns.forcedRequest([{id:"do-filters-"+n.listtype+"list-remove",params:i},{id:"filters-"+n.listtype+"list"}]).then(function(){var e=t.find(".js-email-from-list input[type=checkbox]"),n=e.filter(":checked");e.length===n.length?(t.closest(".b-filters-list__added").addClass("g-hidden"),t.find(".b-filters-list__added-list").empty()):n.closest(".b-filters-list__item-list").remove(),ns.events.trigger("daria:filters:remove")},function(){t.find(".js-delete-button").prop("disabled",!1)})},_onSubmitFiltersListsAdd:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n=Daria.parseQuery(t.data("params")).listtype,r=i.a.sanitize($.trim(nb.$block(".js-input-email",t).getValue())),s="black"===n?Daria.Filter.appendEmailBlackList:Daria.Filter.appendEmailWhiteList,l=t.closest(".b-filters__lists"),c=l.find(".b-filters-list_"+n),d=l.find(".b-filters-list_"+("black"===n?"white":"black"));nb.$block(".js-button-submit",t).disable(),t.find(".b-notification").addClass("g-hidden");var u=s(r);u.done(function(){c.find(".b-filters-list__added").removeClass("g-hidden").find(".b-filters-list__added-list").prepend(Jane.tt("setup:filters-lists-emails-email",{addresses:r})),d&&(d.find(".js-email-from-list input[type=checkbox]").filter(function(){return this.value===r}).closest(".b-filters-list__item-list").remove(),d.find(".b-filters-list__item-list").length||d.find(".b-filters-list__added").addClass("g-hidden")),nb.$block(".js-input-email",t).setValue(""),Daria.Dialog.close()}).always(function(){nb.$block(".js-button-submit",t).enable()}).fail(function(e){switch(e){case"required":t.find(".b-notification_error-required").removeClass("g-hidden");break;case"pattern":t.find(".b-notification_error-pattern").removeClass("g-hidden");break;case"own-email":t.find(".b-notification_error-own-email").removeClass("g-hidden");break;case"already":t.find(".b-notification_error-already").removeClass("g-hidden").find(".b-notification__var-email").text(r);break;default:Object(o.showErrorMessage)(a.StatuslineName.FiltersListsAddError,i18n("%Setup_Общая_ошибка"))}}).progress(function(e,i){switch(e){case"cancel":nb.$block(".js-button-submit",t).enable();break;case"is-yandex-email":var o;o=(i=i||{}).name&&i.unsubscribeLink?i18n("%Blacklist_warning_popup_content",i.name,i.unsubscribeLink):i18n("%Blacklist_warning_popup_content_unknown_service"),Daria.Dialog.open({body:o,additionalClass:"b-setup-popup",onclose:function(){u.notify("cancel")},buttons:[{name:"submit",value:i18n("%Blacklist_warning_popup_button"),onclick:function(){u.notify("ok")}},{name:"cancel"}]});break;case"already-in-anti":Daria.Dialog.confirm({title:"",body:"black"===n?i18n("%Setup_Filters_blist_from_wlist",r):i18n("%Setup_Filters_wlist_from_blist",r),width:350,okValue:i18n("%Да"),cancelValue:i18n("%Нет"),okHandler:function(){u.notify("ok")},onclose:function(){u.notify("cancel")}})}})},_onClickFiltersOff:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n=t.data("filid"),i=Object(r.getMailboxUid)();ns.forcedRequest([{id:"do-filters-off",params:{id:n,enabled:0,mailboxUid:i}},{id:"filters",params:{mailboxUid:i}}]).then(function(){var e=t.closest(".b-switch");e.removeClass("b-switch_on").addClass("b-switch_off"),e.closest(".b-filters-filter").addClass("b-filters-filter_disabled").removeClass("b-filters-filter_enabled")})},_onClickFiltersOn:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n=t.data("filid"),i=Object(r.getMailboxUid)();ns.forcedRequest([{id:"do-filters-on",params:{id:n,enabled:1,mailboxUid:i}},{id:"filters",params:{mailboxUid:i}}]).then(function(){var e=t.closest(".b-switch");e.removeClass("b-switch_off").addClass("b-switch_on"),e.closest(".b-filters-filter").removeClass("b-filters-filter_disabled").addClass("b-filters-filter_enabled")})},_onClickFiltersDelete:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n=t.data("filid"),i=this,o=Object(r.getMailboxUid)();Daria.Dialog.open({title:i18n("%Setup_Filters_Dialog_Remove_title"),body:i18n("%Setup_Filters_Dialog_remove_body"),additionalClass:"b-setup-popup",buttons:[{name:"submit",value:i18n("%Удалить"),onclick:function(){Daria.Dialog.close(),Daria.Filter.removeById(n).done(function(){t.closest(".b-filters-filter").remove();var e=ns.Model.get("filters",{mailboxUid:o}).get('.action[!.hidden && .condition.field != "X-yandex-rpop-id"]');e&&e.length||i.$node.find(".b-filters__created, .b-filters__created-title").remove(),ns.events.trigger("daria:vMessages:invalidate"),ns.events.trigger("daria:filters:delete")})}},{name:"cancel"}]})},onClickFiltersCreate:function(){Daria.router.navigate("#setup/filters-create")}}})},4678:function(e,t){ns.ViewCollection.define("messages-preview",{models:{settings:!1,labels:!1,filters:!1,"filters-preview":!0},split:{byModel:"filters-preview",intoViews:"messages-item-preview"},params:function(e){return e},events:{"ns-view-init":"_onInit","ns-view-hide":"_onViewHide","ns-view-show":"_onViewShow","ns-view-htmlinit":"_onHtmlInit","ns-page-before-changed":"_beforeChanged","click@show .js-preview-scroll-top":"_onClickScrollTop","click@show .js-preview-more":"_onClickLoadMore"},yateModule:"setup",methods:{_onInit:function(){"logic"in this.params||this._setEmptyPreviewModel()},_onHtmlInit:function(){if("logic"in this.params){this.$node.find(".b-messages__message__checkbox,.js-toggle-important").remove();var e=this.$node.find(".js-preview-list").is(":empty");this.$node.find(".js-preview-buttons,.js-preview-header").toggleClass("g-hidden",e),this.$node.find(".js-preview-empty").toggleClass("g-hidden",!e)}},_onViewShow:function(){this._previewDestroy=no.nop},_onViewHide:function(){this._moreUpdate||this._previewDestroy(),this._previewDestroy=no.nop},__previewDestroy:function(){this.getModel("filters-preview").destroy()},_beforeChanged:function(){"logic"in this.params?this.getModel("filters-preview").invalidate():this._setEmptyPreviewModel()},_setEmptyPreviewModel:function(){this.getModel("filters-preview").setData({list:{message:[]}})},_onClickLoadMore:function(e){if(e.preventDefault(),!this._lock){var t=this;this._lock=!0;var n=this.getModel("filters-preview"),i=_.clone(this.params);i.offset=n.models.length;var o=ns.Model.get("filters-preview",i);ns.request.models([o]).then(function(){n.insert(o.models),t._moreUpdate=!0,t.update().always(function(){o.get(".hasMore")||t.$node.find(".js-preview-more").addClass("g-hidden"),t._moreUpdate=!1,t._previewDestroy=t.__previewDestroy})}).always(function(){t._lock=!1})}},_onClickScrollTop:function(e){if(e.preventDefault(),e.stopPropagation(),Daria.is3pane())$(".b-layout__inner").scrollTop(0);else{var t=this.$node.closest(".ns-view-setup-filters-create").offset().top;$(window).scrollTop(t)}}}})},4679:function(e,t){ns.View.define("messages-item-preview",{models:{"filters-preview-message":!0,labels:!1,settings:ns.View.defineModelEvents({"ns-model-changed.enable_firstline":"forceUpdate","ns-model-changed.messages_avatars":"invalidate"}),"module-setup":!1},params:{ids:null},yateModule:"setup"})},4680:function(e,t){ns.View.define("setup-filters-create-common",{events:{"submit .js-form-add":"add"},yateModule:"setup",methods:{add:function(e){e.preventDefault();var t=$(e.currentTarget),n=nb.$block(".js-add-button",t);t.prop("disabled",!0),n.disable(),Daria.FilterSimpleCreate({form:t,validate:function(e){return Daria.SetupFiltersCreate.validate(t,$.extend({isSimpleForm:!0},e))},success:function(){ns.events.trigger("daria:filters:create");var e=Daria.router.buildUrl("setup",{tab:"filters"});Daria.router.navigate(e)},complete:function(){n.enable(),t.prop("disabled",!1)},error:function(){n.enable(),t.prop("disabled",!1)}}).create().then(null,function(){n.enable(),t.prop("disabled",!1)})},_bindSelectEvents:function(e){var t=e.nbSelect;t.on("nb-changed",function(){t.getState().value===e.runThen&&Daria.actions.run(e.actionToRun).then(function(e){!function(e,t){var n=e.getSource().length;e.addToSource(t,n-1)}(t,{text:e.name,value:e.id,selected:!0})})})}}})},4681:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(658),o=n.n(i),a=n(340),r=(n.n(a),n(343)),s=(n.n(r),n(340)),l=(n.n(s),n(329)),c=n(351),d=n.n(c),u=n(1442);ns.View.edefine("setup-filters-create",{models:Object.assign({folders:!1,labels:!1,filters:!0,"setup-menu":!0,settings:!1},Object(l.isSharedMailboxes)()?{"address-information":!0}:{"account-information":!0}),events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onshow","ns-view-hide":"onhide","vSetupFiltersCreate:needEnterPassword@show":"_onNeedEnterPassword","submit@show .js-form-edit":"_onFormSubmit","click@show .js-filters-condition-add":"_addCondition","click@show .js-filters-condition-delete":"_deleteCondition","keydown@show .js-filters-condition-delete":"_deleteConditionOnKeyDown","click@show .js-preview":"_preview"},"params+":{id:null,message:null,thread:null,folder:null,label:null,onCreateClick:!1},yateModule:"setup",methods:{onHtmlInit:function(){this.$form=this.$node.find(".js-form"),this._initialFormParams=this.$form.serializeObject();var e=this.params.message||this.params.thread;e&&!this.mMessageData&&ns.request("message",{ids:e}).then(function(e){this.mMessageData=e[0].getData(),this.invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL})},this),this._onDropdownInit()},patchTree:function(){var e=this.super_.patchTree.call(this);return this.mMessageData&&(e["setup-new-filter-by-message"]=this.mMessageData),e},onshow:function(e){var t=this,n=this;nb.init(this.$node),this.nbDependenceController=new Daria.NbDependenceController(this.$node,"setup-filters-create"),this.nbSelectLetterType=nb.$block(".js-letter_type_select",this.$node),this.nbInputForwardAddress=nb.$block(".js-forward_address",this.$node),this.nbInputNotifyAddress=nb.$block(".js-notify_address ",this.$node),this.nbTextareaAutoanswerText=nb.$block(".js-autoanswer-text",this.$node),this.nbLabelsSelect=nb.$block(".js-labels-select",this.$node),this.nbFoldersSelect=nb.$block(".js-move_folder",this.$node),this.nbFilterApplyCheckbox=nb.$block(".js-filter-apply-checkbox",this.$node);var i=this.nbFoldersSelect.getSource()[0];this.nbSelectLetterType.on("nb-changed",function(){var e=n.nbFoldersSelect.getSource()[0];"nospam"===this.getState().value&&e.value===i.value?n.nbFoldersSelect.removeFromSource(0):e.value!==i.value&&n.nbFoldersSelect.addToSource(i,0)}),this.nbSelectLetterType.trigger("nb-changed",this.nbSelectLetterType),this.bindEvents(),this.$node.find(".b-form-layout__field_conditions .b-form-layout__line_condition").each(function(e,n){return t._bindConditionFields(n)}),e.id||nb.$block(".js-filters-condition-add",this.$node).focus();var o=this.$node.find(".js-preview-table");o.css("max-width",o.width());var a=function(){return t.$node.find(".js-move_folder select option").attr("data-class","like-a-pre")};a(),this.nbFoldersSelect.on("nb-source-changed",a),this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},offPageLeave:function(){ns.page.block.remove(this._pageBlockCallback)},onhide:function(){this.invalidate(),this.nbDependenceController.destroy(),this.offPageLeave(),this._onDropdownHide(),nb.destroy(this.$node)},onBeforePageLeave:function(e,t){var n=this,i=t.get("muid")||void 0,o=Daria.router.getCurrentParams().mailboxUid;return Daria.router.getCurrentUrl()!==e||i===o||(setTimeout(function(){ns.page.updateMailboxUid(i),Daria.router.navigate("#setup/filters"),n.offPageLeave()},0),!1)},_bindSelectEvents:function(e){var t=e.nbSelect;t.on("nb-changed",function(){t.getState().value===e.runThen&&Daria.actions.run(e.actionToRun).then(function(e){var n={text:e.name,value:e.id,selected:!0},i=t.getSource().length;t.addToSource(n,i-1)})})},bindEvents:function(){var e=this;this._bindSelectEvents({nbSelect:this.nbFoldersSelect,runThen:"new_folder",actionToRun:"folders.add.filters"}),this._bindSelectEvents({nbSelect:this.nbLabelsSelect,runThen:"new_label",actionToRun:"labels.add.filters"}),this.nbInputForwardAddress&&(this.nbInputForwardAddress.on("nb-focused",this._bindAutocompleterToField),this.nbInputForwardAddress.on("focusin",this._bindAutocompleterToField.bind(this.nbInputForwardAddress)),this.nbInputForwardAddress.on("nb-changed",function(){Daria.SetupFiltersCreate.validate(e.$node,{params:{clicker:"forward"}})})),this.nbInputNotifyAddress&&(this.nbInputNotifyAddress.on("nb-focused",this._bindAutocompleterToField),this.nbInputNotifyAddress.on("focusin",this._bindAutocompleterToField.bind(this.nbInputNotifyAddress))),this.nbTextareaAutoanswerText&&this.nbTextareaAutoanswerText.on("nb-changed",function(){Daria.SetupFiltersCreate.validate(e.$node,{clicker:["reply"],autoanswer:e.nbTextareaAutoanswerText.value})})},_addCondition:function(e){var t=$(e.target).closest(".b-form-layout__block"),n=t.find(".b-form-layout__field_conditions"),i=Jane.tt("setup:filters-condition-new",null,["filters"]);return n.append(i),nb.init(n),this._bindConditionFields(i),1===n.find(".b-form-layout__button_delete").length?t.removeClass("b-form-layout__block_setup-filter-filters-start"):2===n.find(".b-form-layout__button_delete").length&&n.removeClass("b-form-layout__field_show-one-mode"),n.find(".b-form-element__input-text:last").focus(),this._onDropdownInit(),!1},_bindConditionFields:function(e){var t=this,n=/from|to|cc/,i=nb.$block(".js-condition-field-field1",e),o=nb.$block(".js-condition-field-field3",e);function a(){var e=i.getState().value;n.test(e)&&(this.$control.attr("name","field"+(new Date).getTime()),t._bindAutocompleterToField.call(this),this.$control.one("blur",function(){this.$control.attr("name","field3")}.bind(this)))}i&&o&&(o.on("nb-focused",a),o.on("focusin",a.bind(o)),i.on("nb-changed",function(){var e=i.getState().value;n.test(e)||Daria.Autocompleter.getContact().destroy();var t=this,o=this.getSource(),a=o[o.length-1],r=o[o.length-1].value;if(e===r){var s=Jane.tt("setup:filters-sender-create",{value:r}),l=$(s),c=nb.$block(".nb-input",l),d=function(){var e=$.trim(c.getValue());e?(a.text=i18n("%Setup_Filters_Заголовок",e),a.value=e,t.setSource(o),t.setState(a)):(a.text=i18n("%Setup_Filters_Свойство"),a.value="sender",t.setSource(o),t.setState({value:"subject"})),Daria.Dialog.close()};Daria.Dialog.open({title:i18n("%Setup_Filters_sender_dialog_title"),body:l,additionalClass:"b-setup-popup",buttons:[{name:"submit",value:i18n("%Сохранить"),onclick:d},{name:"cancel"}],onopen:function(){c.focus()}}),c.$control.keyup(function(e){13===e.keyCode&&d()})}}))},_deleteCondition:function(e){var t=$(e.target),n=t.closest(".b-form-layout__block"),i=n.find(".b-form-layout__field_conditions"),o=t.closest(".b-form-layout__line");nb.destroy(o),o.remove();var a=i.find(".b-form-layout__button_delete").length;1===a?i.addClass("b-form-layout__field_show-one-mode"):0===a&&n.addClass("b-form-layout__block_setup-filter-filters-start")},_deleteConditionOnKeyDown:function(e){e.keyCode===d.a.ENTER&&this._deleteCondition(e)},_bindAutocompleterToField:function(){this._autocompleter||(this._autocompleter=Daria.Autocompleter.getContact(),this._autocompleter.setOptions({multiple:!1,formatResult:Daria.formatAutocompleteResult}),this._autocompleter.bindField({field:this.$control,focus:1}))},_onNeedEnterPassword:function(e,t){var n=this,i={action:(t=t||{}).action,filterMethod:t.filterMethod,onSuccess:t.onSuccess||_.constant(vow.Promise.resolve()),onError:_.once(t.onError||_.noop),onCancel:t.onCancel||_.noop};ns.forcedRequest("is-user-recently-entered-password").then(function(e){!e[0].get(".check")?Daria.VerifyPasswordChildWindow.show({onSuccess:function(){return n._onPasswordSuccess(i)},onCancel:i.onCancel,onBlocked:u.c}):n._onPasswordSuccess(i)},function(){i.onError()})},_onPasswordSuccess:function(e){var t=vow.Promise.resolve(),n=function(e){return $("body").focus(),vow.Promise.resolve(e)};e.action?(t=t.then(e.action)).then(function(t){var n=_.find(t&&t.invalid,"id",e.filterMethod),i=n&&n.getError();return"password_check"===i?vow.Promise.reject("error password check in filters"):i?vow.Promise.reject():vow.Promise.resolve(t)},function(t){var n=_.find(t&&t.invalid,"id",e.filterMethod),i=n&&n.getError();return["furita_error","blackbox_error","request_uri_too_long","bad_request"].includes(i)&&Object(u.c)(i),vow.Promise.reject(t)}).then(n).then(e.onSuccess).fail(function(){}):ns.forcedRequest([]).then(n).then(e.onSuccess)},_preview:function(e){e.preventDefault(),Jane.c("Применение правила к старым письмам","Клик по проверить");var t=this.$form.serializeObject();Daria.SetupFiltersCreate.processParams(t),Daria.SetupFiltersCreate.validate(this.$form,t)&&this.update(_.extend({},this.params,t,{id:""}))},_checkToShowPopupFiltersWillNotApply:function(){var e=this.$form,t=e.serializeObject();if(Daria.SetupFiltersCreate.validate(e,t)){var n=!1;e.find(".js-setup-filter-forward-checkbox").each(function(){if(nb.block(this).isChecked())return n=!0,!1});var i=vow.Promise.resolve();return n&&(i=new vow.Promise(function(e,n){var i=Daria.Dialog.open({body:Jane.tt("setup:js-filters-confirm-filter-without-forward",t),additionalClass:"b-setup-popup",width:430,buttons:[{name:"submit",value:i18n("%Продолжить"),onclick:function(){i.close(),e()}},{name:"cancel"}],oncancel:n})})),Jane.c("Настройки","Применение правила к старым письмам","Клик по применить"),i}},_applyFilter:function(){var e=this.$form,t=e.serializeObject();Daria.SetupFiltersCreate.validate(e,t)&&this._checkToShowPopupFiltersWillNotApply().then(function(){return new vow.Promise(function(t){Daria.actions.run("filters.edit",{$form:e,isValid:!0,refresh:!0,callback:t})})}).then(function(e){return ns.forcedRequest("filters-apply",{id:e})}).then(function(){return Daria.router.navigate("#setup/filters")}).then(function(){ns.Model.invalidate("folders"),ns.Model.invalidate("messages"),ns.Model.invalidate("message-nearest"),ns.Model.invalidate("message-thread-nearest"),Object(a.showSuccessMessage)(r.StatuslineName.FilterApplied,i18n("%Setup_Filters_Фильтр_успешно_применился"))}).catch(function(){})},_onFormSubmit:function(e){var t=this;e.preventDefault(),this.params.onCreateClick||(this.params.onCreateClick=!0,setTimeout(function(){t.params.onCreateClick=!1},500),this.nbFilterApplyCheckbox.isChecked()?this._applyFilter():Daria.actions.run("filters.edit",{$form:this.$node.find(".js-form")}))},_onDropdownInit:function(){var e=this;$(".nb-select.js-filters-create-select",this.$node).each(function(){nb.block(this).$dropdown.find("ul").attr("role","listbox").attr("tabIndex","-1"),nb.block(this).on("nb-changed",e._onDropdownChanged),nb.block(this).on("nb-opened",e._onDropdownOpened),nb.block(this).on("nb-closed",e._onDropdownClosed)})},_onDropdownHide:function(){var e=this;$(".nb-select.js-filters-create-select",this.$node).each(function(){nb.block(this).off("nb-changed",e._onDropdownChanged),nb.block(this).off("nb-opened",e._onDropdownOpened),nb.block(this).off("nb-closed",e._onDropdownClosed)})},_onDropdownChanged:function(){var e=this.getState().text,t=this.$dropdown.find("a").filter(function(){return $(this).text()===e});t&&this.$node.attr("aria-activedescendant",t.attr("id"))},_onDropdownOpened:function(){this.$node.attr("aria-expanded",!0);var e=this.$dropdown.find("a");e.attr("role","option").attr("aria-selected","false"),e.filter(function(){return $(this).closest("li").hasClass("is-selected")}).attr("aria-selected","true");var t=e.first();t&&this.$node.attr("aria-activedescendant",t.attr("id"))},_onDropdownClosed:function(){this.$node.attr("aria-expanded",!1),this.$node.attr("aria-activedescendant","")}}},"setup-filters-create-common"),Daria.SetupFiltersCreate={validate:function(e,t){var n=!0,i=e.find(".b-notification").addClass("g-hidden"),s=e.find(".b-form-element__input-text[name=field3]"),c=$.isArray(t.clicker)?t.clicker:[t.clicker],d=$.isArray(t.field3)?t.field3:void 0!==t.field3?[t.field3]:[],u=t.letter,f=!t.isSimpleForm,h=d.map(Boolean);if(t.isSimpleForm&&h.push(Boolean(t.attachment)),!(n=f?h.every(function(e){return e}):h.some(function(e){return e}))){var p=!1;h.forEach(function(e,t){e||(i.filter(".b-notification_error-empty-field3").eq(t).removeClass("g-hidden"),p||(s.eq(t).focus(),p=!0))})}if(0===c.length)return Object(a.showErrorMessage)(r.StatuslineName.NoActionError,i18n("%Setup_Filters_no_actions")),!1;if(t.move_folder&&!ns.Model.get("folders").getFolderById(t.move_folder))return Object(a.showErrorMessage)(r.StatuslineName.EmptyFolderError,i18n("%Filters_Folder_Empty_Error")),!1;var b=String(t.autoanswer||"").trim();if(-1!==$.inArray("reply",c)){if(!b.length)return i.filter(".b-notification_error-reply-empty").removeClass("g-hidden"),!1;if(b.length>2e3)return i.filter(".b-notification_error-reply-too-long").removeClass("g-hidden"),!1}return!(-1!==$.inArray("delete",c)||t.move_folder&&ns.Model.get("folders").spamOrTrash(t.move_folder))||"nospam"!==u&&"all"!==u||t.field1&&t.field3?-1===$.inArray("forward",c)||"clearspam"!==u&&"all"!==u?($.each(c,function(e,a){if("forward"===a||"notify"===a){var r=Object(l.getAddressInformationModelName)(),s=ns.Model.get(r).getEmails(),c=t[a+"_address"];if(1===c.split(/[ ,;]/).length&&Jane.FormValidation.checkEmail(c)){var d=new RegExp("^"+o()(c)+"$");s.forEach(function(e){d.test(e)&&(i.filter(".b-notification_error-self-address-"+a).removeClass("g-hidden"),n=!1)})}else i.filter(".b-notification_error-pattern-"+a).removeClass("g-hidden"),n=!1}}),n):(Object(a.showErrorMessage)(r.StatuslineName.CannotForwardSpam,i18n("%Setup_Filters_cant_forward_spam")),!1):(Object(a.showErrorMessage)(r.StatuslineName.CannotCreateFilter,i18n("%Setup_Filters_actions_not_available")),!1)},processParams:u.b},Daria.FilterSimpleCreate=u.a,Daria.FilterSimpleCreatePopup=function(e){var t=Daria.FilterSimpleCreate();return $.extend(t,{validate:function(){return this.form.find("input[name=field3],input[name=attachment]").filter(function(){return"text"===this.type&&$.trim(this.value)||this.checked}).size()},bindAutocompleter:function(){this._autocompleter=Daria.Autocompleter.getContact(),this._autocompleter.setOptions({multiple:!1,formatResult:Daria.formatAutocompleteResult}),this._autocompleter.bindField({field:this.form.find(".b-form-element__input-text_from").get(0),focus:1})},params:{}},e),t},Daria.FilterSimpleCreatePopupSingle=function(e){var t=Daria.FilterSimpleCreatePopup();return $.extend(t,{complete:function(){Daria.Dialog.close()},success:function(e){Object(s.showStatuslineComponent)({name:r.StatuslineName.FilterWasCreated,filterId:e})},error:function(){var e=this;this.form.addClass("b-popup__field_error"),this.form.find("input:text").keyup(function(){e.form.removeClass("b-popup__field_error"),$(this).off("keyup")}).eq(0).focus()}},e),t}},4682:function(e,t){ns.View.edefine("setup-filters-create-simple",{models:{folders:!0,labels:!0,"setup-menu":!0},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-hide":"onhide"},"params+":{action:null},yateModule:"setup",methods:{onhtmlinit:function(){$(".b-form-element__input-text_from",this.$node).focus(function(){var e=Daria.Autocompleter.getContact();e.setOptions({multiple:!1,formatResult:Daria.formatAutocompleteResult}),e.bindField({field:this,focus:1})})},onshow:function(){nb.init(this.$node);var e=nb.$block(".setup-filters-create-simple-folder",this.$node);e&&this._bindSelectEvents({nbSelect:e,runThen:"new_folder",actionToRun:"folders.add.filters"});var t=nb.$block(".setup-filters-create-simple-label",this.$node);t&&this._bindSelectEvents({nbSelect:t,runThen:"new_label",actionToRun:"labels.add.filters"})},onhide:function(){nb.destroy(this.$node),this.invalidate()}}},"setup-filters-create-common")},4683:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),o=(n.n(i),n(340)),a=(n.n(o),n(343));n.n(a);ns.View.define("setup-folders",{models:["settings","folders","labels","setup-menu","filters"],events:{"ns-view-htmlinit":function(){nb.init(this.node);var e=this.$node.find(".b-manager"),t=Jane.watcher.get("setup-folders-scroll-pos");t&&(this.$node.find(".js-folder-container").scrollTop(t),Jane.watcher.set("setup-folders-scroll-pos",null));var n=Jane.watcher.get("setup-folders-container-height");n&&(this.$node.find(".js-folder-container").height(n),Jane.watcher.set("setup-folders-container-height",null));var i=Jane.watcher.get("setup-labels-scroll-pos");i&&(this.$node.find(".js-labels-container").scrollTop(i),Jane.watcher.set("setup-labels-scroll-pos",null)),this.foldersList=new Daria.FoldersListManager($(e[0])),this.labelsList=new Daria.LabelsListManager($(e[1]))},"ns-view-htmldestroy":function(){nb.destroy(this.node),delete this.foldersList,delete this.labelsList},"ns-view-show":function(){var e=this;nb.$block(".js-labels-sort-type",this.node).on("nb-changed",function(){e.labelsList.sort(this.getValue())}),this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},"ns-view-hide":function(){nb.$block(".js-labels-sort-type",this.node).off("nb-changed"),ns.page.block.remove(this._pageBlockCallback),ns.events.trigger("dragndrop.stop")},"dragndrop.dragstart@show":"_onDragndropDragstart","daria:folders.move:done":"_redrawFolderList","click@show .js-folder-switch-open":"_onClickFolderSwitchOpen","click@show .js-folder-add":"_onClickFolderAdd","click@show .js-folder-add-subfolder":"_onClickFolderAddSubfolder","click@show .js-folder-edit":"_onClickFolderEdit","click@show .js-folder-empty":"_onClickFolderEmpty","click@show .js-folder-delete":"_onClickFolderDelete","daria:folder-remove-done@show":"_redrawFolderList","click@show .js-folder-markread":"_onClickFolderMarkread","click@show .js-folder-filter":"_onClickFolderFilter","click@show .js-label-add":"_onClickLabelAdd","click@show .js-label-edit":"_onClickLabelEdit","click@show .js-label-delete":"_onClickLabelDelete","daria:label-remove-done@show":"_labelRemoveDone","click@show .js-label-filter":"_onClickLabelFilter","dragndrop.dragenter@show":"_onDragEnter","dragndrop.drop@show":"_onDrop"},yateModule:"setup",methods:_.extend({_onDragndropDragstart:function(){this.foldersList.deselectAll()},_onDragEnter:function(e,t){this._timer=setTimeout(function(){$(t.currentTarget).closest(".b-folders__nesting").removeClass("b-folders__nesting_closed"),ns.Model.get("folder",{fid:t.fid}).switchFolded(!1)},300)},_onDrop:function(){this._timer&&clearTimeout(this._timer)},_redrawFolderList:function(){this.$node.find(".js-setup-folders-list").html(Jane.tt("setup:new-folders-list",{},["folders"])),this.foldersList.selectedItem="",this.foldersList.updateButtons({})},_afterAddFolder:function(){this._redrawFolderList()},_afterEditFolder:function(e,t){this.$node.find(".fid-"+e+" .b-folders__folder__link").text(t)},_errorClearFolder:function(){Object(o.showErrorMessage)(a.StatuslineName.CannotClearFolder,i18n("%Setup_Folders_clear_error"))},_onClickFolderSwitchOpen:function(e){e.preventDefault(),e.stopPropagation(),ns.Model.get("folder",{fid:e.currentTarget.getAttribute("data-fid")}).switchFolded(),Jane.watcher.set("setup-folders-scroll-pos",this.$node.find(".js-folder-container").scrollTop()),Jane.watcher.set("setup-labels-scroll-pos",this.$node.find(".js-labels-container").scrollTop()),Jane.watcher.set("setup-folders-container-height",this.$node.find(".js-folder-container").height()),Daria.router.navigate()},_onClickFolderAdd:function(e){e.preventDefault(),e.stopPropagation();var t=Daria.FolderCreatePopup();$.extend(t,{success:this._afterAddFolder.bind(this)}),t.init()},_onClickFolderAddSubfolder:function(e){e.preventDefault(),e.stopPropagation();var t=Daria.FolderCreatePopup({parent_id:this.foldersList.selectedItem,withoutSubfolderDialog:!0});$.extend(t,{success:this._afterAddFolder.bind(this)}),t.init()},_onClickFolderEdit:function(e){e.preventDefault(),e.stopPropagation();var t=this.foldersList.selectedItem,n=Daria.FolderEditPopup({id:t});$.extend(n,{success:this._afterEditFolder.bind(this)}),n.init()},_onClickFolderEmpty:function(e){e.preventDefault(),e.stopPropagation();var t,n=$(e.currentTarget).data("type"),o=ns.Model.get("folders"),a=o.getFolderById(this.foldersList.selectedItem);t=o.isFolder(a.fid,[i.WellKnownFolderSymbol.TRASH])?"<p>"+i18n("%Folders_Clear_Text")+"</p>":Jane.tt("setup:js-setup-folders-dialog-folder-exclear");var r=Daria.FolderClearPopup({fid:a.fid,type:n,template:t});$.extend(r,{onsuccess:this._redrawFolderList.bind(this),onerror:this._errorClearFolder.bind(this)}),r.init()},_onClickFolderDelete:function(e){e.preventDefault(),e.stopPropagation(),Daria.Folder.remove(this.foldersList.selectedItem)},_onClickFolderMarkread:function(e){e.preventDefault(),e.stopPropagation(),Jane.watcher.set("setup-folders-scroll-pos",this.$node.find(".js-folder-container").scrollTop()),Jane.watcher.set("setup-labels-scroll-pos",this.$node.find(".js-labels-container").scrollTop()),Jane.watcher.set("setup-folders-container-height",this.$node.find(".js-folder-container").height()),Daria.markReadFolder(this.foldersList.selectedItem),Daria.router.navigate()},_onClickFolderFilter:function(e){e.preventDefault(),e.stopPropagation(),Daria.Folder.createFilter(this.foldersList.selectedItem)},_onClickLabelAdd:function(e){e.preventDefault(),e.stopPropagation();var t=Daria.LabelCreatePopup();$.extend(t,{success:function(e){this.$node.find(".js-setup-labels-list").prepend(Jane.tt("setup:new-label",{lid:e},["labels"]))}.bind(this)}),t.init()},_onClickLabelEdit:function(e){e.preventDefault(),e.stopPropagation();var t=this.labelsList.selectedItem,n=Daria.LabelEditPopup({id:t});$.extend(n,{success:function(){this.$node.find(".js-setup-labels-list .item-"+t).replaceWith(Jane.tt("setup:new-label",{lid:t},["labels"])),this.labelsList.selectedItem=null,this.labelsList.updateButtons({})}.bind(this)}),n.init()},_onClickLabelDelete:function(e){e.preventDefault(),e.stopPropagation(),Daria.Label.remove(this.labelsList.selectedItem)},_labelRemoveDone:function(e,t){this.$node.find(".js-setup-labels-list .item-"+t).remove(),this.labelsList.selectedItem=null,this.labelsList.updateButtons({}),ns.Model.invalidate("messages")},_onClickLabelFilter:function(e){e.preventDefault(),e.stopPropagation(),Daria.Label.createFilter(this.labelsList.selectedItem)}},Daria.Mixins.SetupTab)})},4684:function(e,t){ns.View.define("setup-journal",{models:["journal","folders","labels"],events:{"ns-view-show":"onShow","ns-view-hide":"onHide"},methods:_.extend({onShow:function(){this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},onHide:function(){ns.page.block.remove(this._pageBlockCallback)}},Daria.Mixins.SetupTab),yateModule:"setup"})},4685:function(e,t){ns.View.define("checkbox-tree",{events:{"click .js-toggle-selection":"toggleSelection","click .js-toggle-tabs-selection":"toggleOnlyTabsSelection","click .js-toggle-folding":"toggleFolding"},models:{"checkbox-tree-state":!1},yateModule:"setup",methods:{toggleSelection:function(e){var t=this.getModel("checkbox-tree-state"),n=String($(e.currentTarget).data("fid")),i=t.getFolderTree(),o=!t.isSelected(n),a=t.calcSelectedFids(i,n,o);t.setSelectedFids(a)},toggleOnlyTabsSelection:function(e){var t=this.getModel("checkbox-tree-state"),n=String($(e.currentTarget).data("tabid")),i=ns.Model.get("tabs").getTab(n),o=!t.isTabSelected(n);if(i){var a=t.calcSelectedTabIds(n,o);t.setSelectedTabIds(a)}},toggleFolding:function(e){e.stopPropagation();var t=String($(e.currentTarget).data("fid")),n=this.getModel("checkbox-tree-state"),i=!n.get(".hashOfFoldedFids.fid"+t);n.set(".hashOfFoldedFids.fid"+t,i)}}})},4686:function(e,t){ns.View.define("checkbox-tree-popup-toggle",{events:{"click .js-checkbox-tree-popup-toggle":"openPopup","form-cacher.unchanged":"onFormReset","daria:folder-remove-done@init":"resetSelectedFids","daria:folder-add-done@init":"resetSelectedFids"},models:{"checkbox-tree-state":{"ns-model-changed.subscribedFolders":"_update","ns-model-changed.subscribedTabs":"_update","ns-model-changed.disabled":"resetAndUpdate"}},yateModule:"setup",methods:{onFormReset:function(e,t){_.startsWith(t.instance,"editing-and-sending-emails")&&this.getModel("checkbox-tree-state").reset()},resetAndUpdate:function(){this.getModel("checkbox-tree-state").reset(),this._update()},resetSelectedFids:function(){this.getModel("checkbox-tree-state").resetSelectedFids()},openPopup:function(){if(this.vPopup&&this.vPopup.isValid())return this.vPopup.close(),void(this.vPopup=null);this.vPopup=ns.View.create("checkbox-tree-popup"),this.vPopup.open({where:this.$node.find(".js-checkbox-tree-popup-toggle"),width:170,maxHeight:170,withoutTail:!0,how:{at:"left bottom",my:"left top"}})},_update:function(){if(this.isVisible()){this.invalidate(),this.update();var e=this.getModel("checkbox-tree-state");this._updateInput(".js-subscribed-folders",e.serializeSelectedFids()),Daria.areFoldersTabsEnabled()&&this._updateInput(".js-subscribed-tabs",e.serializeSelectedTabsIds())}},_updateInput:function(e,t){var n=this.$node.find(e).get(0);nb.block(n).setValue(t)}}})},4687:function(e,t){ns.View.define("checkbox-tree-popup",{models:{"checkbox-tree-state":{"ns-model-changed":"update","ns-model-changed.subscribedFolders":"update","ns-model-changed.subscribedTabs":"update","ns-model-changed.hashOfFoldedFids":"update"}},yateModule:"setup",methods:{open:function(e){this.updateByLayout("checkbox-tree-popup",{},{execFlag:ns.U.EXEC.PARALLEL}).then(function(){this.nbPopup=nb.block(this.node),this.nbPopup.open(e),this.nbPopup.on("nb-closed",this.destroySelf.bind(this))},this)},update:function(){this.updateByLayout("checkbox-tree-popup",{},{execFlag:ns.U.EXEC.PARALLEL})},close:function(){this.nbPopup&&this.nbPopup.close()},destroySelf:function(){var e=this;_.defer(function(){e.nbPopup&&(e.nbPopup.destroy(),e.nbPopup=null),e.destroy()})}}})},4688:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(333),o=n(86),a=n(396);n.n(a);ns.View.define("setup-other",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-htmldestroy":"onHtmlDestroy","ns-view-show":"onShow","ns-view-hide":"onHide","click@show .js-shortcuts-help":"onShowShortcutsHelp","click .mail-Settings-HowTo":"onInboxGPTHowToClick","click .js-browser-notify-setting":"onBrowserNotifySettingClick","keypress@show .js-messages-per-page":"onMessagesPerPageChange","keydown@show .js-messages-per-page":"onMessagesPerPageKeydown","submit@show .js-setup-form":"onSubmitSetupForm","beforeunload@show window":"onBeforeUnloadPage","daria:PushManager:permissionResolved@show":"onChangedBrowserNotifyMessage","change .js-messages-avatars-setting":"onMessagesAvatarsSettingChange","change .js-inbox-gpt-setting":"onInboxGptSettingChange","form-cacher.unchanged@show":"onFormCacherUnchanged"},models:{"setup-menu":!1,settings:{"ns-model-changed":"onSettingsChange","ns-model-changed.browser_notify_message":"onChangedBrowserNotifyMessage","ns-model-changed.show_ads_for_staff":"onChangedShowAdvertisement","ns-model-changed.messages_per_page":"onChangedMessagesPerPage","ns-model-changed.disable_inboxattachs":"onChangedDisableInboxattachs","ns-model-changed.enable_hotkeys":"onChangedEnableHotkeys","ns-model-changed.show_widgets_decor":"_reloadPage","ns-model-changed.show_widgets_buttons":"_reloadPage","ns-model-changed.show_folders_tabs":"_reloadPage","ns-model-changed.show_priority_stuff":"_reloadPage","ns-model-changed.show_shared_mailboxes":"_reloadPage","ns-model-changed.layout":"_reloadPage"},"checkbox-tree-state":!1},yateModule:"setup",ctor:function(){this.operaArrowPressed=!1,this._pageReload=this._pageReload.bind(this),this._pageReloadOnce=_.noop},methods:_.extend({onHtmlInit:function(){var e=this;this.$node.find(".js-setup-form-container").each(function(){var t=$(this);e.addFormCacher(t),new Daria.NbDependenceController(t,_.uniqueId(e.id))})},_reloadPage:function(){this._pageReloadOnce=_.once(this._pageReload)},onShow:function(){this.onPageLeave()},onHide:function(){this.offPageLeave()},onShowShortcutsHelp:function(e){e.preventDefault(),void 0!==Daria.Shortcuts&&Daria.Shortcuts.showShortcutsHelp()},onBrowserNotifySettingClick:function(){var e=nb.block(this.$node.find(".js-browser-notify-setting")[0]).isChecked();this._checkBrowserNotifySubsetting(e)},onBrowserNotifySettingUnchanged:function(){var e=nb.block(this.$node.find(".js-browser-notify-setting")[0]).isChecked();this._checkBrowserNotifySubsetting(!e)},preparationFormData:function(e){return e[a.Settings.MAIL_INBOXGPT_ENABLED]&&Daria.is3pane&&(e[a.Settings.LAYOUT]=a.LayoutTypes.Pane2),e},_checkBrowserNotifySubsetting:function(e){this.$node.find(".js-browser-notify-subsettings").toggleClass("is-hidden",e)},onMessagesPerPageKeydown:function(e){this.operaArrowPressed=Modernizr.opera&&_([37,38,39,40]).contains(e.which)},onMessagesPerPageChange:function(e){e.ctrlKey||e.metaKey||_([0,9,8,48,49,50,51,52,53,54,55,56,57]).contains(e.which)||this.operaArrowPressed||e.preventDefault(),this.operaArrowPressed=!1},onSettingsChange:function(e,t){this.isVisible()?t?this.invalidate():Daria.router.reloadPage(document.location.href):this.invalidate()},onChangedBrowserNotifyMessage:function(){this.isVisible()&&(this.invalidate(),this.update())},onChangedShowAdvertisement:function(){this.isVisible()&&this._reloadPage()},onChangedMessagesPerPage:function(){this.isVisible()&&ns.Model.invalidate("messages")},onChangedDisableInboxattachs:function(){this.isVisible()&&ns.events.trigger("daria:vSetupOther:inboxattachs-changed")},onChangedEnableHotkeys:function(){if(this.isVisible()){var e=this.getModel("settings").getSign("enable_hotkeys")?"on":"off";ns.events.trigger("toggleShortcuts",e)}},onSaveSettingsSuccess:function(){ns.events.trigger("daria:settings:changed")},onFormCacherUnchanged:function(){this.onBrowserNotifySettingUnchanged(),this._pageReloadOnce()},_pageReload:function(){Daria.router.reloadPage(document.location.href)},onHtmlDestroy:function(){this._offInput()},_offInput:function(){var e=this;[".js-subscribed-folders",".js-subscribed-tabs"].forEach(function(t){var n=e.$node.find(t).get(0);if(n){var i=nb.block(n);["nb-focused","focusin","nb-blured","focusout","nb-changed"].forEach(function(e){i.off(e)})}})},onMessagesAvatarsSettingChange:function(){var e=nb.block(this.$node.find(".js-messages-avatars-setting")[0]).isChecked();this.toggleShowCheckboxInsideUserpicCheckboxVisibility(e)},toggleShowCheckboxInsideUserpicCheckboxVisibility:function(e){this.$node.find(".js-show-checkbox-inside-userpic-setting").toggleClass("is-hidden",e)},shouldShowControlToEnableSidebarWithWidgets:function(){var e=Object(i.getConfig)();return Object(i.isB2BUser)()&&!Object(i.isCorp)()&&e&&"ru"===e.TLD},showAdsForStaff:function(){return Daria.hasSid(669)},canUseTabs:function(){return Daria.canUseTabs()},onInboxGPTHowToClick:function(){Object(o.showInboxGPTOnboarding)(),Jane.c("Settings","Interface","How_inboxgpt_works","click")},onInboxGptSettingChange:function(){var e=nb.block(this.$node.find(".js-inbox-gpt-setting")[0]).isChecked();Jane.c("Settings","Interface","Mail_inboxgpt_enabled",e?"off":"on")}},Daria.Mixins.SetupTab)},"setup-form")},4689:function(e,t){ns.View.define("setup-security",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-htmldestroy":"onHtmlDestroy","click .js-clear-search-history":"onClearSearchHistory","ns-view-show":function(){this._pageBlockCallback=this.onBeforePageLeave.bind(this),ns.page.block.add(this._pageBlockCallback)},"ns-view-hide":function(){ns.page.block.remove(this._pageBlockCallback)}},models:["settings","setup-menu","account-information"],methods:_.extend({onHtmlInit:function(){this._clearSearchHistory=this._initClearSearchHistory()},onHtmlDestroy:function(){this._destroyClearSearchHistory()},_initClearSearchHistory:function(){var e=this.$node.find(".js-clear-search-history").get(0);return{btnBlock:e&&nb.block(e),$result:this.$node.find(".js-clear-search-history_result")}},_destroyClearSearchHistory:function(){var e=(this._clearSearchHistory||{}).btnBlock;e&&e.destroy(),this._clearSearchHistory=null},onClearSearchHistory:function(e){e.preventDefault(),e.stopPropagation();var t=this._clearSearchHistory,n=t.btnBlock,i=t.$result;n&&(n.disable(),i.addClass("is-hidden"),ns.forcedRequest("do-clean-suggest-history",{all:!0}).then(this._onClearSearchHistoryResult.bind(this,!0),this._onClearSearchHistoryResult.bind(this,!1)),Jane.c("Search","Settings","Clear search history"))},_onClearSearchHistoryResult:function(e){var t=this._clearSearchHistory,n=t.btnBlock,i=t.$result;if(n){var o=e?i18n("%Setup_Other_Search_Clear-history_Success"):i18n("%Setup_Other_Search_Clear-history_Error");i.text(o).toggleClass("result_error",!e).toggleClass("result_success",e).removeClass("is-hidden"),e||n.enable()}}},Daria.Mixins.SetupTab),yateModule:"setup"})},4690:function(e,t){ns.View.define("setup-sender-editor-mixin",{yateModule:"setup",methods:{getEditorId:function(){throw new Error("Daria.vSetupSenderEditorMixin.getEditorId не имеет реализации")},getEditor:function(){var e=CKEDITOR.instances[this.getEditorId()];if(e&&"ready"===e.status)return e},destroyEditor:function(){var e=this.getEditor();e&&e.destroy(!0)},toggleLock:function(e){var t=this.getEditor();t&&t.setReadOnly(e)},focusEditor:function(){var e,t=this.getEditor();t&&(t.focus(),(e=t.createRange()).moveToElementEditEnd(e.root),t.getSelection().selectRanges([e]))},onPastefileDrop:function(e){e.data.info&&e.data.info.hasImage&&Daria.Dialog.notice({title:i18n("%Произошла_ошибка"),body:"<p>"+i18n("%Wys_signature_image_sizelimit")+"</p>",width:500,hideCrossClose:!0})},pastefileCreateImageAttributes:function(e){return{src:e.url}}}})},4691:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(134),a=(n.n(o),n(138)),r=n.n(a),s=n(135),l=n.n(s),c=n(378),d=(n.n(c),n(4692)),u=n(340),f=(n.n(u),n(343)),h=(n.n(f),n(335)),p=n(1454),b=(n.n(p),n(329));function m(e,t,n,i,o,a,r){try{var s=e[a](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}var g=function(e,t,n,o){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),l=0;l<r;l++)s[l]=arguments[l+3];t.children=s}if(t&&a)for(var c in a)void 0===t[c]&&(t[c]=a[c]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(d.a,{});!function(){var e=n(4698),t=n(4699);ns.View.edefine("setup-sender",{models:Object.assign({"module-editor":!1,"setup-menu":!0,"signature-langs":!0,signs:!1},Object(b.isSharedMailboxes)()?{"ws-userinfo":!1,"mailbox-settings":{"ns-model-changed.default_email":"onChangedDefaultEmail"},"address-information":!0}:{settings:{"ns-model-changed.default_email":"onChangedDefaultEmail"},"account-information":!0}),events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-htmldestroy":"onHtmlDestroy","click .js-signature-edit":"onSignatureEdit","click .js-signature-save":"onSignatureSave","click .js-signature-add":"onSignatureAdd","click .js-signature-delete":"onSignatureDelete","click .b-form-element_signature-inactive.js-setup-signature":"onSignatureEdit","click input[name=default_email]":"onDefaultEmailClick",click:"onCacheNodeClick","resize@show window":"_onWindowResize","submit@show .js-form-submit":"onSubmitSetupForm","daria:vSetupSender:createNewSignature@show":"createNewSignature","setup-sender-masonry-reset@show":"_masonryReset","setup-sender-masonry-reload@show":"_masonryReload","form-cacher.unchanged@show":"onFormCacherUnchanged"},yateModule:"setup",ctor:function(){this._pageReloadOnce=l.a.noop},paramsRewrite:function(e){return Object(b.isSharedMailboxes)()?e.fields="name":delete e.fields,e},methods:{editorId:"signature_new",onHtmlInit:function(){var e=this.$node,t=this.form=e.find("form:eq(0)");nb.init(e),this.formCacher=this.addFormCacher(this.$node.find(".js-setup-form-container")),this.formCacher.cancelChanges=function(){$("form:eq(0)",e).find(".js-radio-input input[name=default_email]").each(function(){var e=nb.block($(this).closest(".js-radio-input").get(0)),t=e&&e.$node.attr("original-value");if(t){var n=e.$node.closest(".b-form-layout__line"),i=nb.$block(".js-radio-select",n);e.setValue(t),i.setState({value:t})}}),Daria.nbFormCacher.prototype.cancelChanges.apply(this)},t.on("onSave",function(){var e=$(this);e.find(".nb-checkbox").each(function(){var e=$(this).closest(".b-form-layout__line"),t=nb.block(this);if("radio"!==t.getType())return!0;t.isChecked()?e.addClass("b-form-element__radio_checked"):e.removeClass("b-form-element__radio_checked")});var t=[];e.find(".nb-checkbox input[name=default_email]").each(function(){var e=nb.block($(this).closest(".nb-checkbox").get(0)),n=e.$node.attr("original-value"),i=e.isChecked(),o=e.$node.closest(".b-form-layout__line"),a=nb.$block(".js-radio-select",o);t.push([e,n,i,a])}),$.each(t,function(e,t){t[1]&&!t[2]&&(t[0].setValue(t[1]),t[3]&&t[3].setState({value:t[1]})),t[1]&&t[2]&&t[0].$node.attr("original-value",t[0].getValue())}),$.each(t,function(e,t){t[2]&&(t[0].check(),t[3]&&t[3].setState({value:t[0].getValue()}),Daria.actions.run("header.update-default-email",{email:t[0].getValue()}))})}),this._onDropdownInit(),$(".js-bind-address",this.$node).each(function(){nb.block(this).on("nb-changed",function(){this.isChecked()?Jane.c("Настройки","Отправитель","Подписи","Привязать к адресу","On"):Jane.c("Настройки","Отправитель","Подписи","Привязать к адресу","Off")})}),$(".js-signature_select",this.$node).each(function(){nb.block(this).on("nb-changed",function(){this.isChecked()?Jane.c("Настройки","Отправитель","Подписи","Разрешить выбор подписи","On"):Jane.c("Настройки","Отправитель","Подписи","Разрешить выбор подписи","Off")})})},onHtmlDestroy:function(){nb.destroy(this.node)},onShow:function(){this._lockSignature=!1,this._$signatureContext=$(".js-setup-signatures",this.form);var t=Boolean(Daria.router.getCurrentParams().signaturePromo),n=this._$signatureContext.find(".js-new-signature");$.each(Daria.signs.getHtml(),function(t,i){new e(i).insertAfter(n)}),ns.events.trigger("setup-sender-masonry-reload");var i=this.getConfig();i.startupMode="wysiwyg",i.viewParams=l.a.clone(this.params),this._timeoutEditorCreate=setTimeout(function(){CKEDITOR.replace("signature_new",i)},0),t&&$("body,html").animate({scrollTop:n.offset().top},500);var o=Daria.signs.count();o?1===o?Jane.c("Настройки","Отправитель","Показ","Одна подпись"):Jane.c("Настройки","Отправитель","Показ","2 или более подписей"):Jane.c("Настройки","Отправитель","Показ","Без подписей"),this.onPageLeave(),this.beautifulEmailContainer=this.node.querySelector(".js-beautiful-email-block"),r.a.render(g,this.beautifulEmailContainer)},onHide:function(){this._pageReloadOnce=l.a.noop,Daria.Dropdown.closeAll(),this.destroyEditor(),$(".js-setup-signature",this._$signatureContext).each(function(){this.signature.destroyEditor()}),$(".js-setup-signature",this._$signatureContext).remove(),this._masonryDestroy(),delete this._$signatureContext,this.offPageLeave(),r.a.unmountComponentAtNode(this.beautifulEmailContainer),this.invalidate()},_onWindowResize:function(){ns.events.trigger("setup-sender-masonry-reset")},saveSignatures:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var a=e.apply(t,n);function r(e){m(a,i,o,r,s,"next",e)}function s(e){m(a,i,o,r,s,"throw",e)}r(void 0)})}}(regeneratorRuntime.mark(function e(){var t,n,i,o,a,r,s,c,d,b,m,g,_,v,y=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=y.length>0&&void 0!==y[0]?y[0]:null,n=y.length>1&&void 0!==y[1]?y[1]:null,i=y.length>2&&void 0!==y[2]?y[2]:l.a.noop,o=this,a=$(".js-setup-signature",this._$signatureContext),r=Daria.signs.count(),s=[],c=a.map(function(){if(this.signature.saveState(),this.signature!==n)return this.signature.isEmpty()?void s.push(this.signature):this.signature}).get().reverse(),null!==n&&(s=s.concat(n)),null!==t&&(c=c.concat(t)),s.length){e.next=17;break}if(d=!1,$.each(c,function(e,t){t.isChanged()&&(d=!0)}),d){e.next=17;break}return $(".js-setup-signature",o._$signatureContext).each(function(){this.signature.closeEditor()}),i(!0,Daria.signs.getHtml(),!1),e.abrupt("return");case 17:return b=[],$.each(c,function(e,t){t.transaction(!0),b.push(t.getData())}),m=b.length,g=this.getModel("signs"),e.prev=21,e.next=24,g.save(b);case 24:e.next=31;break;case 26:return e.prev=26,e.t0=e.catch(21),e.t0&&e.t0.constructor===g.SignsError?(_=g.SignsError.codes,e.t0.code===_.MAX_COUNT?(Object(u.showErrorMessage)(f.StatuslineName.SignatureMaxCountLimitExceeded,Object(h.default)("statusline/max_signature_count_limit_exceeded")),Array.from(this._$signatureContext[0].querySelectorAll(".js-setup-signature")).forEach(function(e){return e.signature.closeEditor()}),ns.events.trigger("setup-sender-masonry-reset")):e.t0.code===_.MAX_LENGTH&&Object(u.showErrorMessage)(f.StatuslineName.SignatureMaxLengthLimitExceeded,Object(h.default)("statusline/signatureMaxLengthLimitExceeded",{count:p.SIGNATURE_MAX_LENGTH}))):(Daria.debug.error("Error occurred while edit signs:",e.t0),Object(u.showErrorMessage)(f.StatuslineName.SignatureAppendError,i18n("%Signature_save_error"))),i(!1,Daria.signs.getHtml(),!1),e.abrupt("return");case 31:null===t&&l.a.isEmpty(s)?Object(u.showStatuslineComponent)({name:f.StatuslineName.SignatureUpdated}):l.a.isEmpty(s)?Object(u.showStatuslineComponent)({name:f.StatuslineName.SignatureAdded}):Object(u.showStatuslineComponent)({name:f.StatuslineName.SignatureDeleted}),c.forEach(function(e){return e.transaction(!1)}),s.forEach(function(e){return e.remove()}),v=Daria.signs.getHtml(),c.length===v.length&&Array.from(this._$signatureContext[0].querySelectorAll(".js-setup-signature")).forEach(function(e){var t=e.signature;t.update(v[t.index()]).closeEditor()}),i(!0,v,r!==m),(0===r&&1===m||1===r&&0===m)&&this.update();case 38:case"end":return e.stop()}},e,this,[[21,26]])}));return function(){return e.apply(this,arguments)}}(),onSignatureEdit:function(e){if(this._lockSignature)return!1;var t=$(e.target).closest(".js-setup-signature").get(0).signature;if(t.isEditable())return!1;var n=this;return this.onSignatureSave($.Event("signature-edit",{data:{callback:function(){t.openEditor(function(){ns.events.trigger("setup-sender-masonry-reset"),Jane.c("Настройки","Отправитель","Подписи","Редактировать")},n)}}})),this._onDropdownInit(),!1},onSignatureSave:function(e){if(this._lockSignature)return!1;var t=e&&e.data&&e.data.callback||$.noop,n=$(".js-setup-signature",this._$signatureContext).filter(function(){return this.signature.isEditable()});if(!n.length)return t(),!1;this.lockSignature(!0);var i=this;return this.saveSignatures(null,null,function(e,o,a){i.lockSignature(!1),e&&(t(),a?ns.events.trigger("setup-sender-masonry-reload"):ns.events.trigger("setup-sender-masonry-reset"),n.find(".js-setup-signature-text img").one("load",function(){ns.events.trigger("setup-sender-masonry-reset")}))}),"click"===e.type&&Jane.c("Настройки","Отправитель","Подписи","Сохранить"),!1},appendSignature:function(t,n){if(this._lockSignature)return!1;var i=(new e).saveState(t);if(i.isEmpty())return!1;this.lockSignature(!0);var o=this;return this.saveSignatures(i,null,function(e,t){o.lockSignature(!1),e&&(i.update(t.pop()).clearEditor().insertAfter($(".js-new-signature",o._$signatureContext)),ns.events.trigger("setup-sender-masonry-reload"),n())}),!1},createNewSignature:function(){var e=this.$node.find(".js-new-signature"),t=Daria.signs,n=t.sample(),i=this;if(t.count()<2&&n){var o=n.content;this.appendSignature({text:o,convert:o},function(){ns.events.trigger("daria:vSignaturePromo:close"),i.focusEditor()}),Jane.c("Настройки","Отправитель","Промо подписей","Клик с добавлением примера")}else{var a=e.offset().top;Daria.is2pane()?$("body,html").animate({scrollTop:a},500):$(".js-block-setup-sender").animate({scrollTop:a},500),this.focusEditor(),Jane.c("Настройки","Отправитель","Промо подписей","Клик для скрола")}},appendSeparator:t,onSignatureAdd:function(){if(this._lockSignature)return!1;var t=$(".js-new-signature",this._$signatureContext),n=new e(null,t).saveState();if(n.isEmpty())return!1;this.lockSignature(!0),n.data.text&&(n.data.text=this.appendSeparator(n.data.text));var i=this;return this.saveSignatures(n,null,function(e,o){i.lockSignature(!1),e&&o.length&&(n.update(o.pop()).clearEditor("").insertAfter(t),n.$node.find(".js-setup-signature-text img").one("load",function(){ns.events.trigger("setup-sender-masonry-reset")}),ns.events.trigger("setup-sender-masonry-reload"))}),Jane.c("Настройки","Отправитель","Подписи","Добавить"),!1},onSignatureDelete:function(e){if(this._lockSignature)return!1;Daria.Dialog.open({body:"<p>"+i18n("%Setup_signature_delete_confirm")+"</p>",additionalClass:"b-setup-popup",width:200,buttons:[{name:"delete",value:i18n("%Удалить"),onclick:function(){t.lockSignature(!0);var n=$(e.currentTarget).closest(".js-setup-signature").get(0).signature;t.saveSignatures(null,n,function(e){t.lockSignature(!1),e?(ns.events.trigger("setup-sender-masonry-reload"),Daria.Dialog.close()):Daria.Dialog.close()}),Jane.c("Настройки","Отправитель","Подписи","Подтверждение удаления","Удалить")}},{name:"cancel",link:!0,value:i18n("%Отмена")}],oncancel:function(){Jane.c("Настройки","Отправитель","Подписи","Подтверждение удаления","Отмена")}});var t=this;return Jane.c("Настройки","Отправитель","Подписи","Подтверждение удаления"),!1},lockSignature:function(e){e=Boolean(e),this._lockSignature=e,this.toggleLock(e),$(".js-setup-signature",this._$signatureContext).each(function(){this.signature.toggleLock(e)}),$(".js-signature-add,.js-signature-save",this._$signatureContext).each(function(){e?nb.block(this).disable():nb.block(this).enable()}),$("input:checkbox,select",this._$signatureContext).prop("disabled",e)},onDefaultEmailClick:function(e){this.$node.find("input[name=default_email]").index(e.currentTarget)?Jane.c("Настройки","Отправитель","Email","Выбор не первого"):Jane.c("Настройки","Отправитель","Email","Выбор первого")},onCacheNodeClick:function(e){var t=$(e.target).closest(".js-setup-signature").get(0);t&&t.signature.isEditable()||this.onSignatureSave($.Event("click",{originalEvent:e}))},_masonryOptions:function(){return{autoResize:!0,container:$(".js-setup-signatures"),offset:20,align:"left",direction:"left",comparator:function(e,t){var n=$(e).data("index"),i=$(t).data("index");return(n=void 0===n?Number.POSITIVE_INFINITY:parseInt(n,0))>(i=void 0===i?Number.POSITIVE_INFINITY:parseInt(i,0))?-1:1}}},_masonry:function(e){if(e=e||$.noop,this.__masonry)e(this.__masonry);else{var t=this;Daria.Libs(["Wookmark"],function(){setTimeout(function(){var n=$(".js-new-signature,.js-setup-signature");n.height(function(e,t){$(this).data("wookmark-height",t)}),t.__masonry=n.wookmark(t._masonryOptions()).wookmarkInstance,e(t.__masonry)},200)})}},_masonryDestroy:function(){this.__masonry&&(this.__masonry.clear(),this.__masonry=null,delete this.__masonry)},_masonryReset:function(){this._masonry(function(e){$(".js-new-signature,.js-setup-signature").height(function(e,t){$(this).data("wookmark-height",t)}),e.layout(!1)})},_masonryReload:function(){var e=this;Daria.Libs(["Wookmark"],function(){e.__masonry=$(".js-new-signature,.js-setup-signature").wookmark(e._masonryOptions()).wookmarkInstance})},preparationFormData:function(e){return l.a.omit(e,"userLang")},getConfig:function(){var e={},t=this;return CKEDITOR.editorConfig(e),l.a.extend(e,CKEDITOR.ConfigFactory.getConfig(CKEDITOR.ConfigFactory.SIGNATURE,{"pastefile:dropfile":this.onPastefileDrop.bind(this)},{pastefileGetPlaceholderContext:function(){var e=t.$node.closest(".mail-Editor .cke_contents_wrap")[0];return e||(e=document.body),new CKEDITOR.dom.element(e)},pastefileGetDropContext:function(){var e=t.$node.closest(".mail-Editor .cke_contents_wrap")[0];return e||(e=document),e},pastefileCreateImageAttributes:this.pastefileCreateImageAttributes},this)),e},getBeautifulEmail:function(){if(Object(c.isAvailable)()){var e,t=Object(b.getAddressInformationModelName)(),n=this.getModel(t).get(".email"),i=this.getModel(t).getBeautifulEmail();return i&&(e=l.a.find(n,function(e){var t=e.login,n=e.domain;return"".concat(t,"@").concat(n)===i})),e}},getLogins:function(){var e=Object(b.getAddressInformationModelName)();return this.getModel(e).getDefaultLogins()},getAlternateLogins:function(){var e=this.getLogins(),t=Object(b.getAddressInformationModelName)();return this.getModel(t).getAlternateLogins(e)},isAlias:function(e){return this.getAlternateLogins([e]).includes(e)},getEditorId:function(){return this.editorId},_getSignsCount:function(){return Daria.signs.count()},onChangedDefaultEmail:function(){this.isVisible()&&!this.isClosing&&(this._pageReloadOnce=l.a.once(this._pageReload))},onFormCacherUnchanged:function(){this._pageReloadOnce()},onSaveSettingsSuccess:function(){ns.events.trigger("daria:settings:changed")},_pageReload:function(){Daria.router.reloadPage(document.location.href)},_onDropdownInit:function(){$(".nb-select.js-radio-select",this.$node).each(function(){var e=nb.block(this).$dropdown;e.find("ul").attr("role","listbox"),nb.block(this).on("nb-changed",function(){var t=this.getState().value,n=this.getState().text,i=this.$node.closest(".b-form-layout__line"),o=nb.$block(".js-radio-input",i),a=e.find("a").filter(function(){return $(this).text()===n});o&&(o.setValue(t),o.check()),a&&this.$node.attr("aria-activedescendant",a.attr("id"))}),nb.block(this).on("nb-opened",function(){this.$node.attr("aria-expanded",!0);var t=e.find("a"),n=e.find("a");t.attr("role","option").attr("aria-selected","false"),n.filter(function(){return $(this).closest("li").hasClass("is-selected")}).attr("aria-selected","true")}),nb.block(this).on("nb-closed",function(){this.$node.attr("aria-expanded",!1),this.$node.attr("aria-activedescendant","")})})}}},"setup-sender-editor-mixin","setup-form")}()},4692:function(e,t,n){"use strict";n.d(t,"a",function(){return I});var i,o=n(134),a=(n.n(o),n(324)),r=n.n(a),s=n(147),l=(n.n(s),n(4693)),c=(n.n(l),n(362)),d=(n.n(c),n(359)),u=n(341),f=n(331),h=n(4696),p=n(405),b=(n.n(p),n(383)),m=(n.n(b),n(520)),g=n.n(m),_=n(378),v=(n.n(_),n(4697));n.n(v);function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function k(e,t,n,o){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),l=0;l<r;l++)s[l]=arguments[l+3];t.children=s}if(t&&a)for(var c in a)void 0===t[c]&&(t[c]=a[c]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var w="SenderBeautifulEmailBlock",S={Block:w,Left:"".concat(w,"-Left"),Right:"".concat(w,"-Right"),Icon:"".concat(w,"-Icon"),Checkbox:"".concat(w,"-Checkbox"),Disabled:"".concat(w,"-Disabled"),EmailLoading:"".concat(w,"-EmailLoading")},C=function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(t=window).i18n.apply(t,["%".concat(e)].concat(i))},D="loading",x="error",j="loaded",$=k("br",{}),F=k(h.a,{}),M=Object(s.withStaticTheme)(c.PS_LIGHT)(function(e){if(!(Object(_.isForceAvailable)()||Object(_.isPromoAvailable)()))return null;var t=y(Object(o.useState)(D),2),n=t[0],i=t[1],a=y(Object(o.useState)("my@email.ru"),2),s=a[0],c=a[1];return Object(o.useEffect)(function(){p.BeautifulEmailStore.instance().getSuggestedEmail().then(function(e){e?(c(e),i(j)):i(x)}).catch(function(){i(x)})},[]),k("div",{className:r()(S.Block,e.className)},void 0,k("span",{className:S.Left},void 0,k(u.default,{cls:S.Icon,id:"mail--Settings_setup-beautiful-email"})),k("div",{className:S.Right},void 0,k(f.default,{loc:"promo-react/beautiful-email-promo1-description-free-user"},void 0,k("span",{className:r()(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},S.EmailLoading,n===D)),"data-ref":"email"},void 0,s)),$,k(l.NavLink,{icon:F,href:"#setup/beautiful-email"},void 0,C("Setup_beautiful-email_connect_link"))))}),E=k(h.a,{}),O=Object(s.withStaticTheme)(c.PS_LIGHT)(function(e){var t=e.domain,n=e.className,i=C("Setup_beautiful-email_connecting").replace(/(<x-email\s*\/>)/,t);return k("div",{className:r()(S.Block,n)},void 0,k("div",{className:S.Left},void 0,k("span",{className:r()(S.Icon,S.Checkbox,S.Disabled)})),k("div",{className:S.Right},void 0,k("div",{className:S.Disabled},void 0,i),k(l.NavLink,{icon:E,href:"#setup/beautiful-email"},void 0,C("Setup_beautiful-email_modify"))))}),P=k(M,{}),L=k(function(){var e=y(Object(o.useState)(!1),2),t=e[0],n=e[1],i=y(Object(o.useState)(b.BeautifulEmailStatus.InfoUnavailable),2),a=i[0],r=i[1],s=y(Object(o.useState)(""),2),l=s[0],c=s[1];return Object(o.useEffect)(function(){g()().then(function(e){var t=e.status,i=e.login,o=void 0===i?"inbox":i,a=e.domain;a&&c("".concat(o,"@").concat(a)),r(t),n(!0)}).catch(function(){r(b.BeautifulEmailStatus.Failed),n(!0)})},[]),t?a===b.BeautifulEmailStatus.Connecting?k(O,{domain:l}):a===b.BeautifulEmailStatus.Disconnected?null:P:null},{}),N=k(M,{}),I=function(){var e=Object(_.getConnectedBeautifulEmail)();return!Object(_.isAvailable)()||e?null:k(d.default,{lang:Daria.locale},void 0,Object(_.hasSubscriptionWithDomain)()?L:N)}},4693:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NavLink=void 0;var i=n(4694);Object.defineProperty(t,"NavLink",{enumerable:!0,get:function(){return i.NavLink}})},4694:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NavLink=void 0;var s=r(n(134)),l=r(n(324)),c=n(173),d=r(n(4695)),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.icon,i=a(e,["className","icon"]);return s.default.createElement(c.Link,o({className:l.default(d.default.root,t),view:"default"},i),this.props.children,n?s.default.createElement("span",{className:d.default.icon},n):null)},t}(s.default.PureComponent);t.NavLink=u},4695:function(e,t){e.exports={root:"NavLink__root--2ZJku",icon:"NavLink__icon--kbRNI"}},4696:function(e,t,n){"use strict";var i,o=n(134);n.n(o);function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var r=function(e,t,n,o){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),l=0;l<r;l++)s[l]=arguments[l+3];t.children=s}if(t&&a)for(var c in a)void 0===t[c]&&(t[c]=a[c]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fill:"currentColor",d:"M7.19 6L3.597 9.595a.75.75 0 101.061 1.06L8.781 6.53a.75.75 0 000-1.06L4.658 1.345a.75.75 0 00-1.06 1.06L7.19 6z"});t.a=function(e){return o.createElement("svg",a({width:12,height:12,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),r)}},4697:function(e,t){},4698:function(e,t,n){var i=n(337),o=i.Features,a=i.hasFeature;function r(e,t){this.id=r.uniqueID(),this.name="signature_"+this.id,this.$node=t,this.data=e||{},this._changed=!1}Daria.actions.define("setup.signature.change.lang",function(e,t){ns.events.trigger(e,t)}),r.uniqueID=function(){var e=0;return function(){return e++}}(),_.extend(r.prototype,ns.View.info("setup-sender-editor-mixin").methods),r.prototype.getEditorId=function(){return this.$node&&this.$node.length&&this.$node.find("textarea").attr("id")||""},r.prototype.insertAfter=function(e){var t=Jane.tt("setup:js-setup-signatures",{id:this.id,name:this.name,text:this.data.convert,emails:this.data.emails,lang:this.data.lang,userLang:this.data.userLang},["settings","signature-langs"],Daria.router.getCurrentParams());return this.$node=$(t).insertAfter(e),t.signature=this,this},r.prototype.remove=function(){this.$node&&(this.destroyEditor(),this.$node.remove())},r.prototype.update=function(e){var t=Daria.Constants.CONTACTS.DELIMITER;return this.data=e,this._changed=!1,this.$node&&(this.$node.find(".js-setup-signature-text").html(this.data.convert),this.$node.find(".js-setup-signature-emails").html(this.data.emails.join(t)),this.$node.find(".js-setup-signature-lang").html(Jane.tt("setup:js-setup-signatures-info-lang",{lang:this.data.lang},["signature-langs"],Daria.router.getCurrentParams()))),this},r.prototype.index=function(){if(!this.$node)return-1;var e=$(".js-setup-signature");return e.length-e.index(this.$node)-1},r.prototype.openEditor=function(e,t){if(this.isEditable()||!this.$node)return this;e=e||$.noop;var n=this.$node.height(),i=this.$node.find("textarea").attr("id"),o=this;return this.getEditor()?(this._onEditorInit(e,n,!0),this):(setTimeout(function(){CKEDITOR.replace(i,o.getConfig(e,n,t))},0),this)},r.prototype.closeEditor=function(){return this.isEditable()&&this.$node&&(ns.events.off("setup.signature.change.lang"),this.$node.addClass("b-form-element_signature-inactive"),Daria.Dropdown.closeAll(),nb.destroy(this.$node)),this},r.prototype.clearEditor=function(e){if(!this.$node)return this;e=e||"";var t=this.getEditor(this.$node.attr("id"));return t&&(t.updateElement(),t.setData(e)),nb.$block(".js-bind-address",this.$node).uncheck(),this},r.prototype.isEditable=function(){return!this.$node||!this.$node.hasClass("b-form-element_signature-inactive")},r.prototype.saveState=function(e){if(!this.isEditable())return this;e=e||{};var t=$.extend({},{text:this.data.text,emails:this.data.emails,userLang:this.data.userLang}),n="",i=this.getEditor(this.$node.find("textarea").attr("id"));if(this.$node&&i){n=i.getData()||"",this.data.text=n;var o=[];nb.$block(".js-bind-address",this.$node).isChecked()&&o.push(nb.$block(".js-radio-select",this.$node).getState().value),this.data.emails=o,this.data.userLang=this.$node.find('[name="userLang"]').val()}return $.extend(this.data,e),this._changed=!1,t.text!==n?this._changed=!0:JSON.stringify(t.emails)!==JSON.stringify(this.data.emails)?this._changed=!0:t.userLang!==this.data.userLang&&(this._changed=!0),this},r.prototype.getData=function(){return this.data},r.prototype.isEmpty=function(){return Daria.signs.isEmpty(this.data.text)},r.prototype.getNode=function(){return this.$node},r.prototype.isChanged=function(){return this._changed||this._transaction},r.prototype.transaction=function(e){return this._transaction=Boolean(e),this._transaction},r.prototype.setLang=function(e){return this.$node.find('[name="userLang"]').val(e),this},r.prototype.getConfig=function(e,t,n){var i={};CKEDITOR.editorConfig(i);var o={pastefileGetPlaceholderContext:function(){return new CKEDITOR.dom.element(document.body)},pastefileGetDropContext:function(){return document},pastefileCreateImageAttributes:this.pastefileCreateImageAttributes,startupMode:"wysiwyg"};return!t||"string"!=typeof t&&"number"!=typeof t||(o.height=t),_.extend(i,CKEDITOR.ConfigFactory.getConfig(CKEDITOR.ConfigFactory.SIGNATURE,{instanceReady:this._onEditorInit.bind(this,e,!1,!1),"pastefile:dropfile":this.onPastefileDrop.bind(this)},o,n))},r.prototype._onEditorInit=function(e,t,n){var i=this,r=this.getEditor();a(o.WEB_EDITOR_SORT_ATTRIBUTES)&&(r.dataProcessor.writer.sortAttributes=!0),nb.init(this.$node),n||r.setData(this.data.convert),t&&r.resize(r.config.width,t,!0),this.$node.removeClass("b-form-element_signature-inactive"),this.focusEditor();var s=nb.$block(".js-bind-address",i.$node),l=nb.$block(".js-radio-select",i.$node);if(this.data.emails.length?s.check():s.uncheck(),this.data.emails.length){var c=this.data.emails.shift();l.setState({value:c})}l.on("nb-changed",function(){s.check()}),ns.events.on("setup.signature.change.lang",function(e,t){i.setLang(t.lang),Daria.Dropdown.closeAll(),i.$node.find(".js-setup-signature-edit-lang").replaceWith(Jane.tt("setup:js-setup-signatures-edit-lang",{lang:t.lang,userLang:t.lang},["signature-langs"],Daria.router.getCurrentParams())),Jane.c(t.metrika.split(":"))}),this.$node.find(".js-setup-signature-edit-lang").replaceWith(Jane.tt("setup:js-setup-signatures-edit-lang",{lang:i.data.lang,userLang:i.data.userLang},["signature-langs"],Daria.router.getCurrentParams())),e()},e.exports=r},4699:function(e,t){e.exports=function(e){var t=!1;function n(e){return e.replace(/[\u0020\u00a0]+/g,"").replace(/&nbsp;/g,"")}if(function(e){return/<[^>]+>/.test(e)}(e)){var i=$(function(e){return e=Daria.Html2Text.text2html(e),"<div>"+(e=_.unescape(e))+"</div>"}(e));i.find("table").parent().css("overflow","auto");var o=i.find("*").filter(function(){if(t)return!1;var e=$(this);if("TABLE"===this.tagName)return t=!0,!0;var i=e.contents().filter(function(){return this.nodeType===Node.ELEMENT_NODE||this.nodeType===Node.TEXT_NODE});if(i.length&&i[0].nodeType===Node.ELEMENT_NODE)return!1;var o=n(e.text());return"--"===o?(t=!0,!1):!(!o&&"IMG"!==this.tagName)&&(t=!0,!0)});return o.length&&$("<div>--&nbsp;</div>").insertBefore(o),Daria.Html2Text.flatDOMHtml(i.html())}return e.replace(/.*/gm,function(e){if(t)return e;var i=n(e);return"--"===i?(t=!0,e):i?(t=!0,"-- \n"+e):e})}},4700:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1344),o=n.n(i),a=n(329);ns.View.define("setup-avatar-setup",{models:Object.assign({"account-information":!1},Object(a.isSharedMailboxes)()?{"mailbox-settings":!1}:{settings:!1}),events:{"ns-view-hide":"invalidate"},methods:{getPassportAvatarUrl:function(){var e={retpath:document.location.href,uid:Daria.uid};return"".concat(Daria.Config["passport-avatar-url"],"?").concat(o.a.stringify(e))},canChangeAvatar:function(){var e=Object(a.getMailboxSettingsModelName)("emails");return(!Object(a.isSharedMailboxes)()||!Object(a.getMailboxUid)())&&this.getModel(e).isNativeEmail()}},yateModule:"setup"})},4701:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(134),a=(n.n(o),n(138)),r=n.n(a),s=n(368),l=n(945),c=n(143),d=(n.n(c),n(4702)),u=n(405),f=(n.n(u),n(480)),h=n(359),p=n(333),b=n(378),m=(n.n(b),n(4703));n.n(m);function g(e,t,n,o){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),l=0;l<r;l++)s[l]=arguments[l+3];t.children=s}if(t&&a)for(var c in a)void 0===t[c]&&(t[c]=a[c]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var _=g(c.Spin,{className:"loader",view:"default",size:"l",progress:!0});ns.View.define("setup-beautiful-email",{models:["setup-menu"],events:{"ns-view-show":"onShow","ns-view-hide":"onHide"},yateModule:"setup",methods:{onShow:function(){var e=d.a,t=Object(f.getCurrentPageParams)();Boolean(t.enabledomain)&&(Object(b.isAvailable)()||(u.BeautifulEmailStore.instance().forceEnableBeautifulEmail().then(function(){Object(f.forceReload)("#setup/beautiful-email")}),e=function(){return new Promise(function(){return null})})),this.container=this.node.querySelector(".js-beautiful-email-container"),Object(s.configureRootTheme)({theme:m.PS_LIGHT,root:this.container}),r.a.render(g(h.default,{lang:Object(p.getLocale)()},void 0,g(l.a,{loader:e,renderPlaceholder:function(){return _}})),this.container)},onHide:function(){r.a.unmountComponentAtNode(this.container)}}})},4702:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(33),o=function(){return Object(i.e)(["beautiful-email.js","beautiful-email.css"]).then(function(e){if(!e||!e[0])return e;var t=e[0],n=t.component;return(0,t.init)().then(function(){return n})})}},4703:function(e,t,n){var i=n(4704),o=n(4707),a=n(940),r=n(362),s=n(1136),l=n(4710),c=n(1135);e.exports=Object.assign({},i,o,a,r,s,l,c)},4704:function(e,t,n){n(4705),n(4706),t.MG_DARK={root:"mg-dark",color:"mg-dark"}},4705:function(e,t){},4706:function(e,t){},4707:function(e,t,n){n(4708),n(4709),t.MG_LIGHT={root:"mg-light",color:"mg-light"}},4708:function(e,t){},4709:function(e,t){},4710:function(e,t,n){n(4711),n(4712),t.PS_SUPERDARK_TRANSPARENT={root:"ps-superdark-transparent",color:"ps-superdark-transparent"}},4711:function(e,t){},4712:function(e,t){},4713:function(e,t){ns.View.define("signature-promo",{models:{settings:!0,"account-information":!0,signs:!1},events:{"ns-view-show":"onShow","daria:vSignaturePromo:close@show":"close","click .js-signature-new-select":"onSignatureNewSelect"},yateModule:"setup",methods:{onShow:function(){this.shouldDisplay()&&(Daria.signs.sample()?Jane.c("Настройки","Отправитель","Промо подписей","Показ"):Jane.c("Настройки","Отправитель","Промо подписей","Показ с примером"))},close:function(){var e=this;return this.$node.find(".js-promo-signature").slideUp(400,function(){e.destroy()}),!1},onSignatureNewSelect:function(e){ns.events.trigger("daria:vSetupSender:createNewSignature"),e.preventDefault()},shouldDisplay:function(){return!(Daria.signs.count()>1)}}})},519:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(n(689)),a=n(333);t.default=function(){var e={modelsUrl:"/web-api/models/liza1",sk:a.getCkey(),uid:a.getUid().toString(),connectionId:a.getConnectionId(),onSkUpdate:a.setCkey};return o.default(e)}},520:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(r,s)}l((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(383),s=a(n(519)),l={pending_registrar:r.BeautifulEmailStatus.Connecting,wait_dns_entries:r.BeautifulEmailStatus.Connecting,registered:r.BeautifulEmailStatus.Connected,failed:r.BeautifulEmailStatus.Failed,cancelled_by_user:r.BeautifulEmailStatus.Disconnected,expired:r.BeautifulEmailStatus.Disconnected,probation:r.BeautifulEmailStatus.Connected};t.default=function(e){return i(void 0,void 0,Promise,function(){var t,n,i,a,c,d;return o(this,function(o){switch(o.label){case 0:t=s.default(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.getDomainStatus(e)];case 2:return n=o.sent(),d=void 0,d=["cancelled_by_user","expired"].includes(n.status)&&n.register_allowed?r.BeautifulEmailStatus.NotConnected:l[n.status]||r.BeautifulEmailStatus.InfoUnavailable,i=void 0,"string"==typeof n.register_allowed_ts&&(i=new Date(n.register_allowed_ts),isNaN(i.getTime())&&(i=void 0)),[2,{status:d,login:n.login,domain:n.domain,timeoutEnd:i}];case 3:return a=o.sent(),c=a&&"object"==typeof a&&"code"in a?a.code:null,[2,{status:d="NOT_FOUND"===c?r.BeautifulEmailStatus.NotConnected:r.BeautifulEmailStatus.InfoUnavailable}];case 4:return[2]}})})}},689:function(e,t,n){"use strict";var i,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(r,s)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Suggest="get-domenator-domains-suggest/v1",e.Register="domenator-register-domain/v1",e.Status="get-domenator-domain-status/v1",e.CancelSubscription="domenator-cancel-subscription/v1",e.ChangeLogin="domenator-change-login/v1"}(i||(i={}));const a=e=>{const[t,n]=e.split("@"),i=n.split("."),o=i.pop()||"ru";return{login:t,domain_base:i.join("."),tld:o}};let r;t.default=(e=>(r?r._updateProps(e):r=new class{constructor({modelsUrl:e,sk:t,uid:n,connectionId:i,extraHeaders:o,onSkUpdate:a,onMock:r}){this.modelsUrl=e,this.sk=t,this.uid=n,this.connectionId=i,this.extraHeaders=o,this.onSkUpdate=a,this.onMock=r,this.updateCkeyPromise=Promise.resolve()}_updateProps({modelsUrl:e,sk:t,uid:n,connectionId:i,onSkUpdate:o,onMock:a}){this.modelsUrl=e,this.sk=t,this.uid=n,this.connectionId=i,this.onSkUpdate=o,this.onMock=a}_updateCkeySynchronous(e){var t;this.sk=e,null===(t=this.onSkUpdate)||void 0===t||t.call(this,e)}_fetch({modelName:e,requestParams:t},n=!1){return o(this,void 0,void 0,function*(){if(this.onMock){const t=yield this.onMock(e);if(t)return t}return this.updateCkeyPromise.then(()=>fetch(`${this.modelsUrl}?_m=${e}`,{method:"POST",headers:Object.assign({"Content-Type":"application/json"},this.extraHeaders),credentials:"include",body:JSON.stringify({models:[{name:e,params:t}],_ckey:this.sk,_uid:this.uid,_connection_id:this.connectionId})}).catch(()=>Promise.reject({isNetworkError:!0}))).then(e=>e.ok?e.json():Promise.reject()).then(i=>{const o=i.models[0],a=i.uid;return!o.error&&o.data?o.data:"ckey"!==o.error||n?Promise.reject(o.error||"beautiful-email-select: unknown api error"):this.uid!==a?(location.reload(),new Promise(()=>null)):(o.renewCkey?this._updateCkeySynchronous(o.renewCkey):this.updateCkeyPromise=this._fetchCkey(),this._fetch({modelName:e,requestParams:t},!0))})})}updateSk(e){this.sk=e}_fetchCkey(){return fetch(`${this.modelsUrl}?_m=get-ckey/v1`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({models:[{name:"get-ckey/v1"}],_uid:this.uid,_connection_id:this.connectionId})}).catch(()=>Promise.reject({isNetworkError:!0})).then(e=>e.ok?e.json():Promise.reject()).then(({models:e})=>{const{ckey:t}=e[0].data;if(!t)throw new Error("beautiful-email-select: ckey update error");this._updateCkeySynchronous(t)})}getSuggestList(e,t){let n=null;return e&&(n="object"==typeof e?{tld:e.tld,domain_base:e.domainBase,login:e.login}:a(e)),this._fetch({modelName:i.Suggest,requestParams:Object.assign(Object.assign({tld:"ru"},t?{limit:String(t)}:null),n)})}registerDomain(e,t){return this._fetch({modelName:i.Register,requestParams:{domain:e,login:t}})}getDomainStatus(e){return this._fetch({modelName:i.Status,requestParams:e?{domain:e}:{}})}cancelSubscription(e){return this._fetch({modelName:i.CancelSubscription,requestParams:e?{domain:e}:{}})}changeLogin(e){return this._fetch({modelName:i.ChangeLogin,requestParams:{login:e}})}}(e),r))},749:function(e,t,n){var i=n(491),o=n(390),a=n(400),r=n(344),s=n(364),l=n(408),c=n(410),d=n(425),u="[object Map]",f="[object Set]",h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(s(e)&&(r(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||d(e)||a(e)))return!e.length;var t=o(e);if(t==u||t==f)return!e.size;if(c(e))return!i(e).length;for(var n in e)if(h.call(e,n))return!1;return!0}},768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0;t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})}}});